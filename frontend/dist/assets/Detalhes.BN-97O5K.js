import{w as ue,e as E,r as j,b as X,J as He,m as d,o as r,F,q as e,j as L,k as O,t as A,E as c,D as P,B as _e,C as me,u as D,g as pe,v as Ce,G as Re,H as ze,N as Ke,y as We,M as Qe}from"./vendor.Mb-DmQZ9.js";import{a as Ye}from"./vue-router.BEbJbLaE.js";import{a as Xe,A as Ze,I as T,_ as Z}from"./index.B4ocTNDR.js";import{u as ge}from"./useGlobalFilters.D4KyStHG.js";import{u as ea}from"./usePeriodManager.ZBl6X03n.js";import{f as N,b as ee,i as H,g as Y,h as ae,j as xe}from"./formatUtils.SsKD9Isb.js";import"./pdf-vendor.BFzd3waL.js";import"./icons-vendor.vP8HAgRq.js";import"./calendarioService.CYLFYZP3.js";import"./useCalendarioCache.CdynBXm1.js";async function aa(n){const o={};n&&(n.segmento&&(o.segmento=n.segmento),n.diretoria&&(o.diretoria=n.diretoria),n.regional&&(o.regional=n.regional),n.agencia&&(o.agencia=n.agencia),n.gerente&&(o.gerente=n.gerente),n.gerenteGestao&&(o.gerenteGestao=n.gerenteGestao),n.familia&&(o.familia=n.familia),n.indicador&&(o.indicador=n.indicador),n.subindicador&&(o.subindicador=n.subindicador),n.dataInicio&&(o.dataInicio=n.dataInicio),n.dataFim&&(o.dataFim=n.dataFim));const _=await Xe(Ze.DETALHES,o);return _.success&&_.data?_.data:(console.error("Erro ao buscar detalhes:",_.error),null)}const ve=j(null),ie=j(!1),oe=j(null),Ae=j(null);let Ve=!1;function J(n){if(!n)return;const o=n.trim();if(!o)return;const _=o.toLowerCase();if(!(_==="todos"||_==="todas"))return o}function ce(n,o){const _={};if(n){const h=J(n.segmento),$=J(n.diretoria),b=J(n.gerencia),y=J(n.agencia),v=J(n.gerente),w=J(n.ggestao),M=J(n.familia),x=J(n.indicador),z=J(n.subindicador);h&&(_.segmento=h),$&&(_.diretoria=$),b&&(_.regional=b),y&&(_.agencia=y),v&&(_.gerente=v),w&&(_.gerenteGestao=w),M&&(_.familia=M),x&&(_.indicador=x),z&&(_.subindicador=z)}return o?.start&&(_.dataInicio=o.start),o?.end&&(_.dataFim=o.end),_}async function Se(n){if(!ie.value){Ae.value=n,ie.value=!0,oe.value=null;try{const o=await aa(n);o?ve.value=o:(oe.value="Não foi possível carregar os dados de detalhes",ve.value=[])}catch(o){console.error("Erro ao carregar detalhes:",o),oe.value=o instanceof Error?o.message:"Erro desconhecido"}finally{ie.value=!1}}}function ta(n,o){if(!Ve){Ve=!0;const{filterTrigger:h}=ge();ue(h,()=>{const $=ce(n.value,o.value);Se($)},{immediate:!0})}const _=async()=>{const h=Ae.value??ce(n.value,o.value);await Se(h)};return{detalhes:E(()=>ve.value??[]),loading:E(()=>ie.value),error:E(()=>oe.value),loadDetalhes:_,buildFilters:()=>ce(n.value,o.value)}}const na={class:"tree-cell"},ia={key:1,class:"toggle toggle--placeholder","aria-hidden":"true"},oa={class:"label-strong"},sa={key:0,class:"col-number"},la=["title"],ra=["title"],da={key:1,class:"cell-content"},ca={class:"actions-cell"},ua={class:"actions-group"},_a={key:0,class:"tree-row tree-detail-row"},ma=["colspan"],va={class:"contract-detail-card"},pa={class:"contract-detail-card__header"},ga={class:"contract-detail-card__header-left"},ba={class:"contract-detail-card__id"},ha={class:"contract-detail-card__id-label"},fa={key:0,class:"contract-detail-card__badge contract-detail-card__badge--canceled"},ya={class:"contract-detail-card__header-center"},wa={class:"contract-detail-card__summary"},ka={class:"contract-detail-card__summary-item"},$a={class:"contract-detail-card__summary-item"},Ca={class:"contract-detail-card__summary-item"},xa={class:"contract-detail-card__summary-item"},Va={class:"contract-detail-card__summary-item"},Sa={class:"contract-detail-card__summary-item"},Ra={class:"contract-detail-card__summary-item"},za={class:"contract-detail-card__header-right"},Aa={class:"contract-detail-card__date"},Da={key:0,class:"contract-detail-card__warning"},Ta={class:"contract-detail-card__warning-content"},ja={class:"contract-detail-card__warning-text"},La={class:"contract-detail-card__warning-details"},Ea={class:"contract-detail-card__table-wrapper"},Ma={class:"contract-detail-card__table"},Fa=X({__name:"TreeTableRow",props:{node:{},level:{},expanded:{type:Boolean},expandedRows:{default:()=>new Set},detailOpen:{type:Boolean,default:!1},activeColumns:{default:()=>[]}},emits:["toggle","action"],setup(n,{emit:o}){const _=n,h=o,$=E(()=>_.node.children.length>0),b=E(()=>_.node.summary.atingimento_p||0),y=E(()=>{const z=b.value;return z>=100?"text-success":z>=80?"text-warning":"text-danger"});function v(z){const l=_.node.summary;switch(z){case"realizado":return N(l.valor_realizado);case"meta":return N(l.valor_meta);case"atingimento_p":return`${ee(l.atingimento_p)}%`;case"meta_diaria":return N(l.meta_diaria);case"referencia_hoje":return N(l.referencia_hoje);case"pontos":return`${ee(l.pontos)} pts`;case"meta_diaria_necessaria":return N(l.meta_diaria_necessaria);case"peso":return`${ee(l.peso)} pts`;case"projecao":return N(l.projecao);case"data":return H(l.data);default:return"—"}}function w(z){const l=_.node.summary;switch(z){case"realizado":return Y(l.valor_realizado);case"meta":return Y(l.valor_meta);case"atingimento_p":return`${ae(l.atingimento_p)}%`;case"meta_diaria":return Y(l.meta_diaria);case"referencia_hoje":return Y(l.referencia_hoje);case"pontos":return`${ae(l.pontos)} pts`;case"meta_diaria_necessaria":return Y(l.meta_diaria_necessaria);case"peso":return`${ae(l.peso)} pts`;case"projecao":return Y(l.projecao);case"data":return H(l.data);default:return""}}const M=E(()=>!!_.node.detail?.dt_cancelamento),x=E(()=>{const z=_.node.label||"";if(!z)return"—";if(z.startsWith("CT-"))return z;const l=z.match(/(\d{4})-?(\d+)/);return l?`${l[1]}-${l[2]}`:z});return(z,l)=>{const Q=He("TreeTableRow",!0);return r(),d(F,null,[e("tr",{class:O(["tree-row","lvl-"+n.level,{"tree-row--expanded":n.expanded}])},[e("td",null,[e("div",na,[$.value||n.node.level==="contrato"?(r(),d("button",{key:0,type:"button",class:O(["toggle",{"is-expanded":n.expanded||n.node.level==="contrato"&&n.expanded}]),onClick:l[0]||(l[0]=V=>h("toggle",n.node.id))},[A(T,{name:n.expanded||n.node.level==="contrato"&&n.expanded?"chevron-down":"chevron-right",size:16},null,8,["name"])],2)):(r(),d("span",ia)),e("span",oa,c(n.node.label||"—"),1)])]),(r(!0),d(F,null,P(n.activeColumns,V=>(r(),d(F,{key:V},[V==="atingimento_p"?(r(),d("td",sa,[e("span",{class:O([y.value,"cell-content"]),title:w(V)},c(v(V)),11,la)])):(r(),d("td",{key:1,class:O(V==="data"?"col-number col-date":"col-number")},[V!=="data"?(r(),d("span",{key:0,title:w(V),class:"cell-content"},c(v(V)),9,ra)):(r(),d("span",da,c(v(V)),1))],2))],64))),128)),e("td",ca,[e("span",ua,[e("button",{type:"button",class:"icon-btn",title:"Abrir chamado","aria-label":"Abrir chamado",onClick:l[1]||(l[1]=_e(V=>h("action",{type:"ticket",node:n.node}),["stop"]))},[A(T,{name:"ticket",size:16})]),n.node.level!=="contrato"?(r(),d("button",{key:0,type:"button",class:"icon-btn",title:"Ver oportunidades","aria-label":"Ver oportunidades",onClick:l[2]||(l[2]=_e(V=>h("action",{type:"opportunities",node:n.node}),["stop"]))},[A(T,{name:"bulb",size:16})])):L("",!0)])])],2),n.node.level==="contrato"&&n.expanded?(r(),d("tr",_a,[e("td",{colspan:n.activeColumns.length+2,class:"tree-detail-cell"},[e("div",va,[e("div",pa,[e("div",ga,[e("div",ba,[e("span",ha,"CT-"+c(x.value),1),M.value?(r(),d("span",fa,[A(T,{name:"alert-triangle",size:16}),l[4]||(l[4]=me(" Cancelado ",-1))])):L("",!0)])]),e("div",ya,[e("div",wa,[e("span",ka,c(D(N)(n.node.summary.valor_realizado)),1),l[5]||(l[5]=e("span",{class:"contract-detail-card__summary-item"},"—",-1)),l[6]||(l[6]=e("span",{class:"contract-detail-card__summary-item"},"—",-1)),e("span",$a,c(D(N)(n.node.summary.meta_diaria)),1),e("span",Ca,c(D(N)(n.node.summary.referencia_hoje)),1),e("span",xa,c(D(ee)(n.node.summary.pontos))+" pts",1),e("span",Va,c(D(N)(n.node.summary.meta_diaria_necessaria)),1),e("span",Sa,c(D(ee)(n.node.summary.peso))+" pts",1),e("span",Ra,c(D(N)(n.node.summary.projecao)),1)])]),e("div",za,[e("span",Aa,c(D(H)(n.node.summary.data)),1),A(T,{name:"ticket",class:"contract-detail-card__icon",size:20})])]),M.value?(r(),d("div",Da,[e("div",Ta,[A(T,{name:"alert-triangle",class:"contract-detail-card__warning-icon",size:20}),e("div",ja,[l[7]||(l[7]=e("strong",{class:"contract-detail-card__warning-title"},"Venda cancelada",-1)),e("p",La," Cancelado em "+c(D(H)(n.node.detail?.dt_cancelamento||""))+". "+c(n.node.detail?.motivo_cancelamento||"Solicitação do cliente"),1)])])])):L("",!0),e("div",Ea,[e("table",Ma,[l[8]||(l[8]=e("thead",null,[e("tr",null,[e("th",null,"Canal da venda"),e("th",null,"Tipo da venda"),e("th",null,"Gerente"),e("th",null,"Condição de pagamento"),e("th",null,"Data de vencimento"),e("th",null,"Data de cancelamento"),e("th",null,"Motivo do cancelamento")])],-1)),e("tbody",null,[e("tr",null,[e("td",null,c(n.node.detail?.canal_venda||"—"),1),e("td",null,c(n.node.detail?.tipo_venda||"—"),1),e("td",null,c(n.node.detail?.gerente||"—"),1),e("td",null,c(n.node.detail?.modalidade_pagamento||"—"),1),e("td",null,c(n.node.detail?.dt_vencimento?D(H)(n.node.detail.dt_vencimento):"—"),1),e("td",null,c(n.node.detail?.dt_cancelamento?D(H)(n.node.detail.dt_cancelamento):"—"),1),e("td",null,c(n.node.detail?.motivo_cancelamento||"—"),1)])])])])])],8,ma)])):L("",!0),n.expanded&&$.value?(r(!0),d(F,{key:1},P(n.node.children,V=>(r(),pe(Q,{key:V.id,node:V,level:n.level+1,expanded:n.expandedRows?.has(V.id)||!1,"expanded-rows":n.expandedRows,"detail-open":!1,"active-columns":n.activeColumns,onToggle:l[3]||(l[3]=B=>h("toggle",B))},null,8,["node","level","expanded","expanded-rows","active-columns"]))),128)):L("",!0)],64)}}}),Ba=Z(Fa,[["__scopeId","data-v-39987054"]]),Ga={class:"chipbar"},Na=["data-view","onClick"],Oa=X({__name:"TableViewChips",props:{views:{},activeView:{}},emits:["viewChange"],setup(n,{emit:o}){const _=n,h=o,$=b=>{b!==_.activeView&&h("viewChange",b)};return(b,y)=>(r(),d("div",Ga,[(r(!0),d(F,null,P(n.views,v=>(r(),d("button",{key:v.id,type:"button",class:O(["chip",{"is-active":v.id===n.activeView}]),"data-view":v.id,onClick:w=>$(v.id)},c(v.label),11,Na))),128))]))}}),Pa=Z(Oa,[["__scopeId","data-v-d6322d2c"]]),Ia={class:"detail-view-bar"},Ua={class:"detail-view-bar__left"},Ja={class:"detail-view-chips"},qa=["onClick"],Ha=X({__name:"DetailViewBar",props:{views:{},activeViewId:{}},emits:["viewChange"],setup(n,{emit:o}){const _=n,h=o,$=b=>{b!==_.activeViewId&&h("viewChange",b)};return(b,y)=>(r(),d("div",Ia,[e("div",Ua,[y[0]||(y[0]=e("span",{class:"detail-view-bar__label"},"Visões da tabela",-1)),e("div",Ja,[(r(!0),d(F,null,P(n.views,v=>(r(),d("button",{key:v.id,type:"button",class:O(["detail-chip",{"is-active":v.id===n.activeViewId}]),onClick:w=>$(v.id)},[e("span",null,c(v.name),1)],10,qa))),128))])])]))}}),Ka=Z(Ha,[["__scopeId","data-v-3c9d8113"]]),Wa={key:0,class:"applied-bar"},Qa={class:"k"},Ya={class:"v"},Xa=["aria-label","onClick"],Za=X({__name:"AppliedFiltersBar",setup(n){const{filterState:o,clearFilter:_}=ge(),h=E(()=>{const b=[];return o.value.segmento&&o.value.segmento!=="Todos"&&b.push({key:"segmento",label:"Segmento",value:o.value.segmento}),o.value.diretoria&&o.value.diretoria!=="Todas"&&b.push({key:"diretoria",label:"Diretoria",value:o.value.diretoria}),o.value.gerencia&&o.value.gerencia!=="Todas"&&b.push({key:"gerencia",label:"Gerência",value:o.value.gerencia}),o.value.agencia&&o.value.agencia!=="Todas"&&b.push({key:"agencia",label:"Agência",value:o.value.agencia}),o.value.ggestao&&o.value.ggestao!=="Todos"&&b.push({key:"ggestao",label:"Gerente de gestão",value:o.value.ggestao}),o.value.gerente&&o.value.gerente!=="Todos"&&b.push({key:"gerente",label:"Gerente",value:o.value.gerente}),o.value.familia&&o.value.familia!=="Todas"&&b.push({key:"familia",label:"Família",value:o.value.familia}),o.value.indicador&&o.value.indicador!=="Todos"&&b.push({key:"indicador",label:"Indicador",value:o.value.indicador}),o.value.subindicador&&o.value.subindicador!=="Todos"&&b.push({key:"subindicador",label:"Subindicador",value:o.value.subindicador}),b}),$=b=>{_(b)};return(b,y)=>h.value.length>0?(r(),d("div",Wa,[(r(!0),d(F,null,P(h.value,v=>(r(),d("div",{key:v.key,class:"applied-chip"},[e("span",Qa,c(v.label),1),e("span",Ya,c(v.value),1),e("button",{type:"button",title:"Limpar",class:"applied-x","aria-label":`Remover ${v.label}`,onClick:w=>$(v.key)},[A(T,{name:"x",size:14})],8,Xa)]))),128))])):L("",!0)}}),et=Z(Za,[["__scopeId","data-v-dba2fb80"]]),at={class:"detail-designer__panel",role:"dialog","aria-modal":"true","aria-labelledby":"detail-designer-title"},tt={class:"detail-designer__head"},nt={key:0,class:"detail-designer__feedback",role:"alert"},it={key:1,class:"detail-designer__views"},ot={class:"detail-designer__views-list"},st=["onClick"],lt=["aria-label","onClick"],rt={class:"detail-designer__lists"},dt={class:"detail-designer__list detail-designer__list--available"},ct={class:"detail-designer__items"},ut={class:"detail-item__handle","aria-hidden":"true"},_t={class:"detail-item__label"},mt=["aria-label","onClick"],vt={key:0,class:"detail-designer__empty"},pt={class:"detail-designer__list detail-designer__list--selected"},gt={class:"detail-designer__items"},bt={class:"detail-item__handle","aria-hidden":"true"},ht={class:"detail-item__label"},ft=["disabled","aria-label","onClick"],yt={key:0,class:"detail-designer__empty"},wt={class:"detail-designer__foot"},kt={class:"detail-designer__save"},$t={class:"detail-designer__input-wrapper"},Ct=["disabled"],xt={class:"detail-designer__actions"},Vt=["disabled"],St=X({__name:"DetailColumnDesigner",props:{modelValue:{type:Boolean},selectedColumns:{},views:{},activeViewId:{}},emits:["update:modelValue","apply","save","load-view","delete-view"],setup(n,{emit:o}){const _=[{id:"realizado",label:"Realizado no período (R$)"},{id:"meta",label:"Meta no período (R$)"},{id:"atingimento_p",label:"Atingimento (%)"},{id:"meta_diaria",label:"Meta diária total (R$)"},{id:"referencia_hoje",label:"Referência para hoje (R$)"},{id:"pontos",label:"Pontos no período (pts)"},{id:"meta_diaria_necessaria",label:"Meta diária necessária (R$)"},{id:"peso",label:"Peso (pts)"},{id:"projecao",label:"Projeção (R$)"},{id:"data",label:"Data"}],h=n,$=o,b=E({get:()=>h.modelValue,set:p=>$("update:modelValue",p)}),y=j([...h.selectedColumns]),v=j(""),w=j(""),M=E(()=>_.filter(p=>!y.value.includes(p.id))),x=E(()=>y.value.length>1),z=p=>{y.value.includes(p)||(y.value.push(p),w.value="")},l=p=>{if(y.value.length<=1){w.value="Mantenha pelo menos uma coluna visível.";return}y.value=y.value.filter(S=>S!==p),w.value=""},Q=()=>{if(y.value.length===0){w.value="Adicione ao menos uma coluna.";return}$("apply",[...y.value]),b.value=!1,w.value=""},V=()=>{const p=v.value.trim();if(y.value.length===0){w.value="Adicione ao menos uma coluna antes de salvar.";return}if(p.length<3){w.value="Use um nome com pelo menos 3 caracteres.";return}$("save",p,[...y.value]),v.value="",w.value="Visão salva com sucesso."},B=p=>{const S=h.views?.find(k=>k.id===p);S&&(y.value=[...S.columns],w.value=""),$("load-view",p)},I=p=>{p!=="default"&&$("delete-view",p)},K=()=>{b.value=!1,y.value=[...h.selectedColumns],v.value="",w.value=""};return ue(()=>h.selectedColumns,p=>{y.value=[...p]},{immediate:!0}),ue(()=>h.modelValue,p=>{p&&(y.value=[...h.selectedColumns],v.value="",w.value="")}),(p,S)=>(r(),pe(Ke,{to:"body"},[b.value?(r(),d("div",{key:0,class:O(["detail-designer",{"is-open":b.value}]),onKeydown:Ce(K,["escape"])},[e("div",{class:"detail-designer__overlay",onClick:K}),e("div",at,[e("header",tt,[S[1]||(S[1]=e("div",null,[e("h4",{id:"detail-designer-title"},"Personalizar colunas"),e("p",{class:"detail-designer__subtitle"}," Arraste as colunas para montar a visão da tabela e salve até 5 configurações preferidas. A coluna de ações continua fixa no final da grade. ")],-1)),e("button",{type:"button",class:"icon-btn detail-designer__close","aria-label":"Fechar personalização",onClick:K},[A(T,{name:"x",size:18})])]),w.value?(r(),d("div",nt,c(w.value),1)):L("",!0),h.views&&h.views.length>0?(r(),d("section",it,[S[2]||(S[2]=e("div",{class:"detail-designer__views-head"},[e("span",null,"VISÕES SALVAS"),e("span",{class:"detail-designer__views-hint"},"Carregue para ajustar ou excluir.")],-1)),e("div",ot,[(r(!0),d(F,null,P(h.views,k=>(r(),d("div",{key:k.id,class:"detail-view-chip-wrapper"},[e("button",{type:"button",class:O(["detail-view-chip",{"is-active":h.activeViewId===k.id}]),onClick:U=>B(k.id)},c(k.name),11,st),k.id!=="default"?(r(),d("button",{key:0,type:"button",class:"detail-view-chip__delete","aria-label":`Remover visão ${k.name}`,onClick:_e(U=>I(k.id),["stop"])},[A(T,{name:"trash",size:16})],8,lt)):L("",!0)]))),128))])])):L("",!0),e("section",rt,[e("div",dt,[S[3]||(S[3]=e("div",{class:"detail-designer__list-head"},[e("h5",null,"Colunas disponíveis"),e("p",null,"Arraste para incluir ou clique para adicionar.")],-1)),e("div",ct,[(r(!0),d(F,null,P(M.value,k=>(r(),d("div",{key:k.id,class:"detail-item detail-item--available"},[e("span",ut,[A(T,{name:"grip-vertical",size:16})]),e("span",_t,c(k.label),1),e("button",{type:"button",class:"detail-item__add","aria-label":`Adicionar ${k.label}`,onClick:U=>z(k.id)},[A(T,{name:"plus",size:16})],8,mt)]))),128)),M.value.length===0?(r(),d("p",vt," Todas as colunas já estão na tabela. ")):L("",!0)])]),e("div",pt,[S[4]||(S[4]=e("div",{class:"detail-designer__list-head"},[e("h5",null,"Colunas na tabela"),e("p",null,"Arraste para reorganizar ou clique para remover.")],-1)),e("div",gt,[(r(!0),d(F,null,P(y.value,k=>(r(),d("div",{key:k,class:O(["detail-item",{"is-disabled":!x.value}])},[e("span",bt,[A(T,{name:"grip-vertical",size:16})]),e("span",ht,c(_.find(U=>U.id===k)?.label||k),1),e("button",{type:"button",class:O(["detail-item__remove",{"is-disabled":!x.value}]),disabled:!x.value,"aria-label":`Remover ${_.find(U=>U.id===k)?.label||k}`,onClick:U=>l(k)},[A(T,{name:"x",size:18})],10,ft)],2))),128)),y.value.length===0?(r(),d("p",yt," Escolha ao menos uma coluna. ")):L("",!0)])])]),e("footer",wt,[e("div",kt,[S[5]||(S[5]=e("label",{for:"detail-view-name",class:"detail-designer__save-label"}," SALVAR NOVA VISÃO ",-1)),e("div",$t,[Re(e("input",{id:"detail-view-name","onUpdate:modelValue":S[0]||(S[0]=k=>v.value=k),type:"text",class:"input input--sm detail-designer__input",maxlength:"48",placeholder:"Ex.: Indicadores priorizados",onKeyup:Ce(V,["enter"])},null,544),[[ze,v.value]]),e("button",{type:"button",class:"btn btn--primary detail-designer__save-btn",disabled:!v.value.trim()||v.value.trim().length<3,onClick:V}," Salvar visão ",8,Ct)]),S[6]||(S[6]=e("small",{class:"detail-designer__save-hint"}," Você pode guardar até 5 visões personalizadas. ",-1))]),e("div",xt,[e("button",{type:"button",class:"btn btn--secondary detail-designer__action-btn",onClick:K}," Cancelar "),e("button",{type:"button",class:"btn btn--primary detail-designer__action-btn",disabled:y.value.length===0,onClick:Q}," Aplicar ",8,Vt)])])])],34)):L("",!0)]))}}),Rt=Z(St,[["__scopeId","data-v-97d15039"]]),zt={class:"detalhes-wrapper"},At={class:"detalhes-view"},Dt={class:"card card--detalhes"},Tt={class:"card__header"},jt={class:"card__actions"},Lt={class:"search-box"},Et={class:"table-controls"},Mt={class:"table-controls__main"},Ft={class:"table-controls__chips"},Bt={class:"table-toolbar-wrapper"},Gt={class:"table-toolbar"},Nt={class:"table-toolbar__icon"},Ot={class:"table-toolbar__icon"},Pt={class:"table-toolbar__icon"},It={key:0,class:"detalhes-skeleton"},Ut={key:0,class:"error-state"},Jt={key:1,class:"empty-state"},qt={key:2,class:"empty-state"},Ht={key:3,class:"contratos-grid"},Kt={class:"contrato-card__header"},Wt={class:"contrato-card__title"},Qt={class:"contrato-card__body"},Yt={class:"contrato-card__info"},Xt={class:"contrato-card__info-item"},Zt={class:"contrato-card__value"},en={key:0,class:"contrato-card__info-item"},an={class:"contrato-card__value"},tn={class:"contrato-card__info-item"},nn={class:"contrato-card__value"},on={class:"contrato-card__info-item"},sn={class:"contrato-card__value"},ln={class:"contrato-card__info-item"},rn={class:"contrato-card__value"},dn={class:"contrato-card__metrics"},cn={class:"contrato-card__metric"},un={class:"contrato-card__metric-value"},_n={class:"contrato-card__metric"},mn={class:"contrato-card__metric-value"},vn={class:"contrato-card__metric"},pn={class:"contrato-card__metric-value"},gn={class:"contrato-card__metric"},bn={class:"contrato-card__metric-value"},hn={key:0,class:"contrato-card__dates"},fn={class:"contrato-card__date-item"},yn={class:"contrato-card__date-value"},wn={key:0,class:"contrato-card__date-item"},kn={class:"contrato-card__date-value"},$n={key:1,class:"contrato-card__cancelamento"},Cn={class:"contrato-card__cancelamento-value"},xn={key:4,class:"table-wrapper"},Vn={class:"tree-table"},Sn=["aria-pressed"],Rn={class:"tree-sort__icon"},zn=["aria-pressed","onClick"],An={class:"tree-sort__icon"},Dn=X({__name:"Detalhes",setup(n){const o=Ye(),{filterState:_}=ge(),{period:h}=ea(),{detalhes:$,loading:b,error:y}=ta(_,h),v=j(new Set),w=j(""),M=j("diretoria"),x=j("default"),z=j(!1),l=j({id:null,direction:null}),Q=["realizado","meta","atingimento_p","meta_diaria","referencia_hoje","pontos","meta_diaria_necessaria","peso","projecao","data"],V=[...Q];function B(i){const t=new Set,a=i.filter(s=>!Q.includes(s)||t.has(s)?!1:(t.add(s),!0));return a.length?a:[...V]}const I=j(B(V)),K=[{id:"diretoria",label:"Diretoria",key:"diretoria"},{id:"gerencia",label:"Regional",key:"gerenciaRegional"},{id:"agencia",label:"Agência",key:"agencia"},{id:"gGestao",label:"Gerente de gestão",key:"gerenteGestao"},{id:"gerente",label:"Gerente",key:"gerente"},{id:"secao",label:"Família",key:"secao"},{id:"familia",label:"Indicador",key:"familia"},{id:"prodsub",label:"Subindicador",key:"prodOrSub"},{id:"contrato",label:"Contratos",key:"contrato"}],p=j([{id:"default",name:"Visão padrão",columns:B(V)}]),S={diretoria:["diretoria","regional","agencia","gerente","familia","indicador","subindicador","contrato"],gerencia:["regional","agencia","gerente","familia","indicador","subindicador","contrato"],agencia:["agencia","gerente","familia","indicador","subindicador","contrato"],gGestao:["gGestao","gerente","familia","indicador","subindicador","contrato"],gerente:["gerente","familia","indicador","subindicador","contrato"],secao:["familia","indicador","subindicador","contrato"],familia:["indicador","subindicador","contrato"],prodsub:["subindicador","contrato"],contrato:["contrato"]};function k(i,t){if(t==="__label__")return i.label||"";const a=i.summary;switch(t){case"realizado":return a.valor_realizado||0;case"meta":return a.valor_meta||0;case"atingimento_v":return a.atingimento_v||0;case"atingimento_p":return a.atingimento_p||0;case"meta_diaria":return a.meta_diaria||0;case"referencia_hoje":return a.referencia_hoje||0;case"pontos":return a.pontos||0;case"meta_diaria_necessaria":return a.meta_diaria_necessaria||0;case"peso":return a.peso||0;case"projecao":return a.projecao||0;case"data":return a.data||"";default:return 0}}function U(i){return!l.value.id||!l.value.direction?i:[...i].sort((a,s)=>{const u=k(a,l.value.id),m=k(s,l.value.id);let f=0;return typeof u=="number"&&typeof m=="number"?f=u-m:f=String(u).localeCompare(String(m),"pt-BR"),l.value.direction==="asc"?f:-f}).map(a=>({...a,children:U(a.children)}))}const be=E(()=>{if(!w.value.trim()||!$.value.length)return[];const i=w.value.toLowerCase().trim(),t=$.value.filter(u=>u.id_contrato?.toLowerCase().includes(i)||u.registro_id?.toLowerCase().includes(i)||u.gerente_nome?.toLowerCase().includes(i)||u.familia_nome?.toLowerCase().includes(i)||u.ds_indicador?.toLowerCase().includes(i)),a=new Map;t.forEach(u=>{const m=u.id_contrato||u.registro_id||"sem-contrato";a.has(m)||a.set(m,[]),a.get(m).push(u)});const s=[];return a.forEach((u,m)=>{const f=u[0];f&&s.push({id:`contrato-${m}`,contratoId:m,items:u,summary:le(u),detail:{canal_venda:f.canal_venda,tipo_venda:f.tipo_venda,gerente:f.gerente_nome,gerente_gestao:f.gerente_gestao_nome,modalidade_pagamento:f.modalidade_pagamento,dt_vencimento:f.dt_vencimento,dt_cancelamento:f.dt_cancelamento,motivo_cancelamento:f.motivo_cancelamento}})}),l.value.id&&l.value.direction&&s.sort((u,m)=>{let f=0,g=0;if(l.value.id==="__label__")f=u.contratoId,g=m.contratoId;else{const C=l.value.id;f=u.summary[C]??0,g=m.summary[C]??0}let R=0;return typeof f=="number"&&typeof g=="number"?R=f-g:R=String(f).localeCompare(String(g),"pt-BR"),l.value.direction==="asc"?R:-R}),s}),te=E(()=>{if(!$.value.length||w.value.trim())return[];const i=S[M.value]||S.diretoria;let t=[];if(M.value==="contrato"){const a=new Map;$.value.forEach(s=>{const u=s.id_contrato||s.registro_id||"sem-contrato";a.has(u)||a.set(u,[]),a.get(u).push(s)}),a.forEach((s,u)=>{const m=s[0];m&&t.push({id:`contrato-${u}`,label:u,level:"contrato",children:[],data:s,summary:le(s),detail:{canal_venda:m.canal_venda,tipo_venda:m.tipo_venda,gerente:m.gerente_nome,gerente_gestao:m.gerente_gestao_nome,modalidade_pagamento:m.modalidade_pagamento,dt_vencimento:m.dt_vencimento,dt_cancelamento:m.dt_cancelamento,motivo_cancelamento:m.motivo_cancelamento}})})}else{const a=i||S.diretoria;t=fe($.value,a,0)}return U(t)}),se=E(()=>w.value.trim().length>0);function he(i){if(i.children.forEach(t=>he(t)),i.children.length>0){const t=i.children.reduce((s,u)=>s+(u.summary.pontos||0),0),a=i.children.reduce((s,u)=>s+(u.summary.peso||0),0);i.summary.pontos=t,i.summary.peso=a}}function fe(i,t,a){if(a>=t.length||i.length===0)return[];const s=t[a],u=t[a+1],m=new Map;i.forEach(g=>{let R;switch(s){case"diretoria":R=g.diretoria_id||"sem-diretoria",g.diretoria_nome;break;case"regional":R=g.gerencia_id||"sem-regional",g.gerencia_nome;break;case"agencia":R=g.agencia_id||"sem-agencia",g.agencia_nome;break;case"gGestao":R=g.gerente_gestao_id||"sem-gerente-gestao",g.gerente_gestao_nome;break;case"gerente":R=g.gerente_id||"sem-gerente",g.gerente_nome;break;case"familia":R=g.familia_id||"sem-familia",g.familia_nome;break;case"indicador":R=g.id_indicador||"sem-indicador",g.ds_indicador;break;case"subindicador":R=g.id_subindicador||"sem-subindicador",g.subindicador;break;case"contrato":R=g.id_contrato||g.registro_id||"sem-contrato";break;default:R="unknown"}m.has(R)||m.set(R,[]),m.get(R).push(g)});const f=[];return m.forEach((g,R)=>{const C=g[0];if(!C)return;let G=C.diretoria_nome||"Sem label";switch(s){case"diretoria":G=C.diretoria_nome||"Sem diretoria";break;case"regional":G=C.gerencia_nome||"Sem regional";break;case"agencia":G=C.agencia_nome||"Sem agência";break;case"gGestao":G=C.gerente_gestao_nome||"Sem gerente de gestão";break;case"gerente":G=C.gerente_nome||"Sem gerente";break;case"familia":G=C.familia_nome||"Sem família";break;case"indicador":G=C.ds_indicador||"Sem indicador";break;case"subindicador":G=C.subindicador||"Sem subindicador";break;case"contrato":G=C.id_contrato||C.registro_id||"Sem contrato";break}const ne={id:`${s}-${R}`,label:G,level:s,children:u?fe(g,t,a+1):[],data:g,summary:le(g)};s==="contrato"&&(ne.detail={canal_venda:C.canal_venda||void 0,tipo_venda:C.tipo_venda||void 0,gerente:C.gerente_nome||void 0,modalidade_pagamento:C.modalidade_pagamento||void 0,dt_vencimento:C.dt_vencimento||void 0,dt_cancelamento:C.dt_cancelamento||void 0,motivo_cancelamento:C.motivo_cancelamento||void 0}),f.push(ne)}),f.forEach(g=>he(g)),f}function le(i){const t=i.reduce((W,q)=>W+(q.valor_realizado||0),0),a=i.reduce((W,q)=>W+(q.valor_meta||q.meta_mensal||0),0),s=i.reduce((W,q)=>W+(q.peso||0),0),u=i.reduce((W,q)=>W+(q.peso||0),0),m=30,f=new Date().getDate(),g=Math.max(1,m-f),R=a/m,C=f>0?Math.min(a,R*f):0,G=g>0?Math.max(0,(a-t)/g):0,ne=f>0?t/Math.max(f,1)*m:t,Ue=t-a,Je=a>0?t/a*100:0,de=i.length>0?i[0]:null,qe=de&&(de.data||de.competencia)||"";return{valor_realizado:t,valor_meta:a,atingimento_v:Ue,atingimento_p:Je,meta_diaria:R,referencia_hoje:C,pontos:s,meta_diaria_necessaria:G,peso:u,projecao:ne,data:qe}}const re=j(new Set);function De(i){if(i.type==="ticket"){const t=Te(i.node),a=new URLSearchParams({openDrawer:"true",intent:"new-ticket",preferredQueue:"POBJ",queue:"POBJ",observation:t}),s=o.resolve({name:"Omega",query:Object.fromEntries(a)});window.open(s.href,"_blank")}else i.type==="opportunities"&&console.log("Abrir oportunidades para:",i.node)}function Te(i){const t=[];if(i.label&&t.push(`Item: ${i.label}`),i.level&&t.push(`Nível: ${i.level}`),i.summary){const a=i.summary;a.valor_realizado&&t.push(`Realizado: R$ ${a.valor_realizado.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`),a.valor_meta&&t.push(`Meta: R$ ${a.valor_meta.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}`),a.atingimento_p!==void 0&&t.push(`Atingimento: ${a.atingimento_p.toFixed(1)}%`)}if(i.detail){const a=i.detail;a.gerente&&t.push(`Gerente: ${a.gerente}`),a.canal_venda&&t.push(`Canal: ${a.canal_venda}`),a.tipo_venda&&t.push(`Tipo de venda: ${a.tipo_venda}`)}return t.join(`
`)}function je(i){const a=ye(te.value,i)?.level==="contrato";v.value.has(i)?(v.value.delete(i),a&&re.value.delete(i)):(v.value.add(i),a&&re.value.add(i))}function ye(i,t){for(const a of i){if(a.id===t)return a;const s=ye(a.children,t);if(s)return s}return null}const Le=E(()=>{const i=K.find(t=>t.id===M.value);return i?i.label:"Item"});function Ee(i){return{realizado:"Realizado no período (R$)",meta:"Meta no período (R$)",atingimento_p:"Atingimento (%)",meta_diaria:"Meta diária total (R$)",referencia_hoje:"Referência para hoje (R$)",pontos:"Pontos no período (pts)",meta_diaria_necessaria:"Meta diária necessária (R$)",peso:"Peso (pts)",projecao:"Projeção (R$)",data:"Data"}[i]||i}function we(i){return l.value.id!==i||!l.value.direction?"arrows-up-down":l.value.direction==="asc"?"arrow-up":"arrow-down"}function ke(i){const t=l.value,s=i==="__label__"?"asc":"desc",u=s==="asc"?"desc":"asc";let m;t.id!==i||!t.direction?m=s:t.direction===s?m=u:m=null,m?l.value={id:i,direction:m}:l.value={id:null,direction:null}}function Me(i){return v.value.has(i)}function Fe(){const i=[];function t(a){a.forEach(s=>{s.children.length>0&&(i.push(s.id),t(s.children))})}t(te.value),v.value=new Set(i)}function Be(){v.value.clear()}function Ge(i){M.value=i}function $e(i){x.value=i;const t=p.value.find(a=>a.id===i);if(t){const a=B(t.columns);t.columns=a,I.value=[...a]}}function Ne(){z.value=!0}function Oe(i,t){const a=B(t),s=p.value.find(u=>u.name.toLowerCase()===i.toLowerCase()&&u.id!=="default");if(s)s.columns=[...a],x.value=s.id;else{if(p.value.filter(f=>f.id!=="default").length>=5){alert("Você já possui 5 visões personalizadas. Exclua uma antes de criar outra.");return}const m={id:`custom-${Date.now()}`,name:i,columns:[...a]};p.value.push(m),x.value=m.id}I.value=[...a],localStorage.setItem("pobj3:detailViews",JSON.stringify(p.value.filter(u=>u.id!=="default"))),localStorage.setItem("pobj3:detailActiveView",x.value)}function Pe(i){if(i==="default")return;const t=p.value.findIndex(a=>a.id===i);if(t>-1){if(p.value.splice(t,1),x.value===i){x.value="default";const a=p.value.find(s=>s.id==="default");if(a){const s=B(a.columns);a.columns=s,I.value=[...s]}}localStorage.setItem("pobj3:detailViews",JSON.stringify(p.value.filter(a=>a.id!=="default"))),localStorage.setItem("pobj3:detailActiveView",x.value)}}function Ie(i){const t=B(i);if(I.value=[...t],x.value==="__custom__"||x.value.startsWith("custom-")){const a=p.value.find(s=>s.id===x.value);a&&(a.columns=[...t],localStorage.setItem("pobj3:detailViews",JSON.stringify(p.value.filter(s=>s.id!=="default"))))}localStorage.setItem("pobj3:detailActiveView",x.value)}return We(()=>{try{const i=localStorage.getItem("pobj3:detailViews");if(i){const a=JSON.parse(i);Array.isArray(a)&&(p.value=[...p.value,...a.map(s=>({id:s.id||`custom-${Date.now()}`,name:s.name||"Visão personalizada",columns:B(Array.isArray(s.columns)?s.columns:[])}))])}const t=localStorage.getItem("pobj3:detailActiveView");if(t){const a=p.value.find(s=>s.id===t);if(a){x.value=t;const s=B(a.columns);a.columns=s,I.value=[...s]}}}catch(i){console.error("Erro ao carregar visões salvas:",i)}}),(i,t)=>(r(),d("div",zt,[e("div",At,[e("div",Dt,[e("header",Tt,[t[4]||(t[4]=e("div",{class:"title-subtitle"},[e("h3",null,"Detalhamento"),e("p",{class:"muted"},"Visualize os contratos em uma estrutura hierárquica")],-1)),e("div",jt,[e("div",Lt,[Re(e("input",{"onUpdate:modelValue":t[0]||(t[0]=a=>w.value=a),type:"text",placeholder:"Contrato (Ex.: 999999)",class:"input input--search"},null,512),[[ze,w.value]])])])]),A(et),e("div",Et,[e("div",Mt,[e("div",Ft,[A(Pa,{views:K,"active-view":M.value,onViewChange:Ge},null,8,["active-view"])]),t[5]||(t[5]=e("div",{class:"table-controls__search"},null,-1))])]),A(Ka,{views:p.value,"active-view-id":x.value,onViewChange:$e},null,8,["views","active-view-id"]),e("div",Bt,[e("div",Gt,[e("button",{type:"button",class:"table-toolbar__btn",onClick:Fe},[e("span",Nt,[A(T,{name:"chevrons-down",size:16})]),t[6]||(t[6]=e("span",{class:"table-toolbar__text"},"Expandir tudo",-1))]),e("button",{type:"button",class:"table-toolbar__btn",onClick:Be},[e("span",Ot,[A(T,{name:"chevrons-up",size:16})]),t[7]||(t[7]=e("span",{class:"table-toolbar__text"},"Recolher tudo",-1))]),e("button",{type:"button",class:"table-toolbar__btn detail-view-manage",title:"Personalizar colunas da tabela",onClick:Ne},[e("span",Pt,[A(T,{name:"columns",size:16})]),t[8]||(t[8]=e("span",{class:"table-toolbar__text"},"Personalizar colunas",-1))])])]),D(b)?(r(),d("div",It,[...t[9]||(t[9]=[Qe('<div class="skeleton skeleton--table-header" style="height:40px;width:100%;margin-bottom:12px;border-radius:8px;" data-v-ccdbe348></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-ccdbe348></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-ccdbe348></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-ccdbe348></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-ccdbe348></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-ccdbe348></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-ccdbe348></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-ccdbe348></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-ccdbe348></div><div class="skeleton skeleton--table-row" style="height:48px;width:100%;margin-bottom:8px;border-radius:8px;" data-v-ccdbe348></div>',10)])])):(r(),d(F,{key:1},[D(y)?(r(),d("div",Ut,[e("p",null,c(D(y)),1)])):se.value&&be.value.length===0?(r(),d("div",Jt,[...t[10]||(t[10]=[e("p",null,"Nenhum contrato encontrado para a busca.",-1)])])):!se.value&&te.value.length===0?(r(),d("div",qt,[...t[11]||(t[11]=[e("p",null,"Nenhum dado encontrado para os filtros selecionados.",-1)])])):se.value?(r(),d("div",Ht,[(r(!0),d(F,null,P(be.value,a=>(r(),d("div",{key:a.id,class:"contrato-card"},[e("div",Kt,[e("h4",Wt,c(a.contratoId),1),e("div",{class:O(["contrato-card__badge",{"is-success":a.summary.atingimento_p>=100,"is-warning":a.summary.atingimento_p>=50&&a.summary.atingimento_p<100,"is-danger":a.summary.atingimento_p<50}])},c(a.summary.atingimento_p.toFixed(1))+"% ",3)]),e("div",Qt,[e("div",Yt,[e("div",Xt,[t[12]||(t[12]=e("span",{class:"contrato-card__label"},"Gerente:",-1)),e("span",Zt,c(a.detail.gerente||"—"),1)]),a.detail.gerente_gestao?(r(),d("div",en,[t[13]||(t[13]=e("span",{class:"contrato-card__label"},"Gerente de gestão:",-1)),e("span",an,c(a.detail.gerente_gestao),1)])):L("",!0),e("div",tn,[t[14]||(t[14]=e("span",{class:"contrato-card__label"},"Canal:",-1)),e("span",nn,c(a.detail.canal_venda||"—"),1)]),e("div",on,[t[15]||(t[15]=e("span",{class:"contrato-card__label"},"Tipo:",-1)),e("span",sn,c(a.detail.tipo_venda||"—"),1)]),e("div",ln,[t[16]||(t[16]=e("span",{class:"contrato-card__label"},"Modalidade:",-1)),e("span",rn,c(a.detail.modalidade_pagamento||"—"),1)])]),e("div",dn,[e("div",cn,[t[17]||(t[17]=e("span",{class:"contrato-card__metric-label"},"Realizado",-1)),e("span",un,c(D(xe)(a.summary.valor_realizado)),1)]),e("div",_n,[t[18]||(t[18]=e("span",{class:"contrato-card__metric-label"},"Meta",-1)),e("span",mn,c(D(xe)(a.summary.valor_meta)),1)]),e("div",vn,[t[19]||(t[19]=e("span",{class:"contrato-card__metric-label"},"Pontos",-1)),e("span",pn,c(D(ae)(a.summary.pontos)),1)]),e("div",gn,[t[20]||(t[20]=e("span",{class:"contrato-card__metric-label"},"Peso",-1)),e("span",bn,c(D(ae)(a.summary.peso)),1)])]),a.detail.dt_vencimento?(r(),d("div",hn,[e("div",fn,[t[21]||(t[21]=e("span",{class:"contrato-card__date-label"},"Vencimento:",-1)),e("span",yn,c(D(H)(a.detail.dt_vencimento)),1)]),a.detail.dt_cancelamento?(r(),d("div",wn,[t[22]||(t[22]=e("span",{class:"contrato-card__date-label"},"Cancelamento:",-1)),e("span",kn,c(D(H)(a.detail.dt_cancelamento)),1)])):L("",!0)])):L("",!0),a.detail.motivo_cancelamento?(r(),d("div",$n,[t[23]||(t[23]=e("span",{class:"contrato-card__cancelamento-label"},"Motivo:",-1)),e("span",Cn,c(a.detail.motivo_cancelamento),1)])):L("",!0)])]))),128))])):(r(),d("div",xn,[e("table",Vn,[e("thead",null,[e("tr",null,[e("th",null,[e("button",{type:"button",class:"tree-sort","aria-pressed":l.value.id==="__label__"&&l.value.direction?"true":"false",onClick:t[1]||(t[1]=a=>ke("__label__"))},[me(c(Le.value)+" ",1),e("span",Rn,[A(T,{name:we("__label__"),size:16},null,8,["name"])])],8,Sn)]),(r(!0),d(F,null,P(I.value,a=>(r(),d("th",{key:a,class:"col-number"},[e("button",{type:"button",class:"tree-sort","aria-pressed":l.value.id===a&&l.value.direction?"true":"false",onClick:s=>ke(a)},[me(c(Ee(a))+" ",1),e("span",An,[A(T,{name:we(a),size:16},null,8,["name"])])],8,zn)]))),128))])]),e("tbody",null,[(r(!0),d(F,null,P(te.value,a=>(r(),pe(Ba,{key:a.id,node:a,level:0,expanded:Me(a.id),"expanded-rows":v.value,"detail-open":re.value.has(a.id),"active-columns":I.value,onToggle:t[2]||(t[2]=s=>je(s)),onAction:De},null,8,["node","expanded","expanded-rows","detail-open","active-columns"]))),128))])])]))],64))])]),A(Rt,{modelValue:z.value,"onUpdate:modelValue":t[3]||(t[3]=a=>z.value=a),"selected-columns":I.value,views:p.value,"active-view-id":x.value,onApply:Ie,onSave:Oe,onLoadView:$e,onDeleteView:Pe},null,8,["modelValue","selected-columns","views","active-view-id"])]))}}),Pn=Z(Dn,[["__scopeId","data-v-ccdbe348"]]);export{Pn as default};
