import{a as Ye,A as He,r as ce,b as v,c as h,d as fe,e as k,o as O,m as je,w as W,f as Z,g as le,n as oe,h as ge,_ as pe,u as We,i as Ze,j as qe,k as Je,l as Xe,p as o,q as f,s as l,S as V,t as ae,v as ve,I as ne,x as Qe,y as me}from"./index.CkqlWseI.js";async function ea(){return(await Ye(He.INIT)).data??null}const P=v(null),ie=v(!1);let M=null;function aa(){const e=async()=>P.value?P.value:M||(ie.value=!0,M=ea().then(s=>(s&&(P.value=s),s)).finally(()=>{ie.value=!1,M=null}),M),t=()=>{P.value=null,M=null};return{initData:ce(P),isLoading:ce(ie),loadInit:e,clearCache:t}}const I=e=>e==null||e===""?"":String(e).trim(),na=(e,t)=>!e&&!t?"":e?!t||t===e?e:`${e} - ${t}`:t,ia=(e,t)=>!e&&!t?"":e?!t||t===e?e:`${e} - ${t}`:t,B=(e,t)=>{const s=String(e.nome??e.label??"").trim();let u="",g;return t==="ggestao"||t==="gerente"?(g=I(e.funcional??""),u=I(e.id??"")):(u=I(e.id??e.codigo??e.id_diretoria??e.id_regional??e.id_agencia??""),g=e.funcional?I(e.funcional):void 0),{id:u,nome:t==="ggestao"||t==="gerente"?ia(g||u,s):na(u,s),id_segmento:I(e.segmento_id??e.id_segmento??e.idSegmento),id_diretoria:I(e.diretoria_id??e.id_diretoria??e.idDiretoria),id_regional:I(e.regional_id??e.id_regional??e.idRegional??e.gerencia_id??e.gerenciaId),id_agencia:I(e.agencia_id??e.id_agencia??e.idAgencia),id_gestor:I(e.id_gestor??e.idGestor??e.gerente_gestao_id??e.gerenteGestaoId),funcional:g}};function ta(e){const t={segmento:v(""),diretoria:v(""),gerencia:v(""),agencia:v(""),ggestao:v(""),gerente:v("")},s=h(()=>e.value?{segmentos:(e.value.segmentos??[]).map(i=>B(i,"segmento")),diretorias:(e.value.diretorias??[]).map(i=>B(i,"diretoria")),regionais:(e.value.regionais??[]).map(i=>B(i,"regional")),agencias:(e.value.agencias??[]).map(i=>B(i,"agencia")),ggestoes:(e.value.gerentes_gestao??[]).map(i=>B(i,"ggestao")),gerentes:(e.value.gerentes??[]).map(i=>B(i,"gerente"))}:null),u=h(()=>{if(!s.value)return null;const i=_=>Object.fromEntries((_??[]).map(p=>[I(p.id),p]));return{segmento:i(s.value.segmentos),diretoria:i(s.value.diretorias),gerencia:i(s.value.regionais),agencia:i(s.value.agencias),ggestao:i(s.value.ggestoes),gerente:i(s.value.gerentes)}}),g={segmento:null,diretoria:"id_segmento",gerencia:"id_diretoria",agencia:"id_regional",ggestao:"id_agencia",gerente:"id_gestor"},r={segmento:null,diretoria:"segmento",gerencia:"diretoria",agencia:"gerencia",ggestao:"agencia",gerente:"ggestao"};function c(i,_){if(!_)return;const p=r[i],G=g[i];if(!p||!G)return;const E=u.value?.[i]?.[I(_)];if(!E)return;const D=I(E[G]??"");if(!D)return;const $=u.value?.[p]?.[D];$&&(t[p].value=$.id,console.debug("[hierarchy] autoFillParent:",{childField:i,childValue:_,parentField:p,parentId:D}),c(p,$.id))}const C=["segmento","diretoria","gerencia","agencia","ggestao","gerente"];function m(i){let _=!1;for(const p of C)_&&(t[p].value=""),p===i&&(_=!0)}function d(i,_){t[i].value=I(_),m(i),c(i,t[i].value)}const y=h(()=>s.value?.segmentos??[]),q=h(()=>s.value?.diretorias??[]),N=h(()=>s.value?.regionais??[]),z=h(()=>s.value?.agencias??[]),K=h(()=>s.value?.ggestoes??[]),L=h(()=>s.value?.gerentes??[]);return{...t,segmentos:y,diretorias:q,regionais:N,agencias:z,gerentesGestao:K,gerentes:L,handleSegmentoChange:i=>d("segmento",i),handleDiretoriaChange:i=>d("diretoria",i),handleGerenciaChange:i=>d("gerencia",i),handleAgenciaChange:i=>d("agencia",i),handleGerenteGestaoChange:i=>d("ggestao",i),handleGerenteChange:i=>d("gerente",i),clearAll:()=>{for(const i of C)t[i].value=""}}}const be=[{value:"mensal",label:"Mensal",monthsBack:0},{value:"semestral",label:"Semestral",monthsBack:5},{value:"anual",label:"Anual",monthsBack:11}];function la(e,t){const u=new Date().toISOString().split("T")[0],g=t||u,r=new Date(g+"T00:00:00Z");if(isNaN(r.getTime())){const d=new Date,y=d.toISOString().split("T")[0];return{start:`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-01`,end:y||`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,"0")}-${String(d.getDate()).padStart(2,"0")}`}}let c;if(e==="anual")c=new Date(Date.UTC(r.getUTCFullYear(),0,1));else if(e==="mensal")c=new Date(Date.UTC(r.getUTCFullYear(),r.getUTCMonth(),1));else{const d=be.find(y=>y.value===e)?.monthsBack||5;c=new Date(Date.UTC(r.getUTCFullYear(),r.getUTCMonth()-d,1))}const C=c.toISOString().split("T")[0]||"",m=r.toISOString().split("T")[0]||"";return{start:C,end:m}}function he(e,t,s){if(e==="mensal"){const u=new Date().toISOString().split("T")[0]||"",r=s||t.end||u||u,c=new Date(r+"T00:00:00Z");return{start:new Date(Date.UTC(c.getUTCFullYear(),c.getUTCMonth(),1)).toISOString().split("T")[0]||"",end:r}}return la(e,t.end)}function oa(e,t){const s=v("mensal");return{accumulatedView:s,handleViewChange:g=>{s.value=g;const r=he(g,e.value);t(r)},options:be}}const sa=["type","disabled","aria-busy","aria-disabled"],da={key:0,class:"btn__spinner","aria-hidden":"true"},ra={key:2},ua={key:3,class:"btn__loading-text","aria-live":"polite","aria-atomic":"true"},ca=fe({__name:"Button",props:{variant:{default:"secondary"},type:{default:"button"},disabled:{type:Boolean,default:!1},icon:{default:void 0},loading:{type:Boolean,default:!1}},setup(e){const t=e,s=v(null),u=g=>{if(t.disabled||t.loading)return;const r=g.currentTarget,c=document.createElement("span"),C=Math.max(r.clientWidth,r.clientHeight),m=C/2,d=r.getBoundingClientRect();c.style.width=c.style.height=`${C}px`,c.style.left=`${g.clientX-d.left-m}px`,c.style.top=`${g.clientY-d.top-m}px`,c.classList.add("ripple");const y=r.getElementsByClassName("ripple")[0];y&&y.remove(),r.appendChild(c),setTimeout(()=>{c.remove()},600)};return(g,r)=>(O(),k("button",je({ref_key:"buttonRef",ref:s,type:e.type,disabled:e.disabled||e.loading,class:["btn",`btn--${e.variant}`,{"btn--loading":e.loading}],"aria-busy":e.loading,"aria-disabled":e.disabled||e.loading},g.$attrs,{onClick:u,onKeydown:[r[0]||(r[0]=W(Z(c=>!e.disabled&&!e.loading&&u(c),["prevent"]),["enter"])),r[1]||(r[1]=W(Z(c=>!e.disabled&&!e.loading&&u(c),["prevent"]),["space"]))]}),[e.loading?(O(),k("span",da)):le("",!0),e.icon&&!e.loading?(O(),k("i",{key:1,class:oe(e.icon),"aria-hidden":"true"},null,2)):le("",!0),e.loading?(O(),k("span",ua,[ge(g.$slots,"default",{},void 0)])):(O(),k("span",ra,[ge(g.$slots,"default",{},void 0)]))],16,sa))}}),te=pe(ca,[["__scopeId","data-v-a56e4887"]]),ga={class:"card card--filters"},va={class:"filters"},ma={class:"filters__group"},fa={class:"filters__group"},pa={class:"filters__group"},ba={class:"filters__actions"},ha={key:0,class:"filters__more filters__more--center"},_a=["aria-hidden"],Sa={class:"adv__grid"},Ia={class:"filters__group"},ya={class:"filters__group"},Ca={class:"filters__group"},Ta={class:"filters__group"},Aa={class:"filters__group"},Fa={class:"filters__group"},Va={class:"filters__group"},Ua={class:"filters__group"},wa=fe({__name:"Filters",setup(e){const t=We(),s=h(()=>t.name==="Simuladores"),u=v(!1),g=v(!0),{initData:r,isLoading:c,loadInit:C}=aa(),m=c,{updateFilter:d,updatePeriod:y,clearFilters:q,triggerFilter:N}=Ze(),{segmento:z,diretoria:K,gerencia:L,agencia:J,ggestao:i,gerente:_,segmentos:p,diretorias:G,regionais:E,agencias:D,gerentesGestao:$,gerentes:se,handleSegmentoChange:_e,handleDiretoriaChange:Se,handleGerenciaChange:Ie,handleAgenciaChange:ye,handleGerenteGestaoChange:Ce,handleGerenteChange:Te,clearAll:Ae}=ta(r),R=v([]),U=v([]),X=v([]),Fe=v([]),T=v(""),S=v(""),A=v(""),Y=v("todos"),Ve=h(()=>{if(!T.value)return U.value;const a=String(T.value).trim();return U.value.filter(n=>(n.id_familia?String(n.id_familia).trim():"")===a)}),de=h(()=>{if(!S.value)return[];const a=String(S.value).trim();return X.value.filter(n=>(n.id_indicador?String(n.id_indicador).trim():"")===a)}),Ue=h(()=>de.value.length>0),H=(a,n)=>{if(!a)return null;const b=String(a).trim();return n.find(w=>String(w.id).trim()===b)||null},we=a=>{if(T.value=a,!a)S.value="",A.value="";else if(S.value){const n=H(S.value,U.value),b=String(a).trim();(n?.id_familia?String(n.id_familia).trim():"")!==b&&(S.value="",A.value="")}},ke=a=>{if(S.value=a,A.value="",a){const n=H(a,U.value);if(n?.id_familia){const b=String(n.id_familia).trim();R.value.some(F=>String(F.id).trim()===b)&&(T.value=b)}}else S.value="",A.value=""},Oe=a=>{if(A.value=a,a){const n=H(a,X.value);if(n?.id_indicador){const b=String(n.id_indicador).trim();if(U.value.some(F=>String(F.id).trim()===b)){S.value=b;const F=H(b,U.value);if(F?.id_familia){const ee=String(F.id_familia).trim();R.value.some(Re=>String(Re.id).trim()===ee)&&(T.value=ee)}}}}else A.value=""},De=a=>{const n=String(a.id||a.codigo||a.id_diretoria||a.id_regional||a.id_agencia||a.funcional||a.subId||a.subindicadorId||"").trim(),b=String(a.label||a.nome||n).trim(),w=a.id_familia??a.idFamilia??a.familia_id??a.familiaId,F=a.id_indicador??a.idIndicador??a.indicador_id??a.indicadorId??a.produtoId??a.produto_id;return{id:n,nome:b,id_familia:w?String(w).trim():void 0,id_indicador:F?String(F).trim():void 0}},j=a=>Array.isArray(a)?a.map(De).filter(n=>n.id):[],$e=async()=>{try{const a=await C();a&&(R.value=j(a.familias||[]),U.value=j(a.indicadores||[]),X.value=j(a.subindicadores||[]),Fe.value=j(a.status_indicadores||[]))}catch(a){console.error("Erro ao carregar estrutura:",a)}},{period:x,updatePeriodLabels:xe,updatePeriod:Me}=qe(),{accumulatedView:re,handleViewChange:Be,options:Ge}=oa(x,Me),Ee=h(()=>[{id:"todos",nome:"Todos"},{id:"atingidos",nome:"Atingidos"},{id:"nao",nome:"Não atingidos"}]),Pe=h(()=>Ge.map(a=>({id:a.value,nome:a.label}))),Ne=a=>{Y.value=a},ze=a=>{Be(a)};Je(()=>{$e(),ue(),N()});const Q=()=>{u.value=!u.value},Ke=()=>{ue(),N()},ue=()=>{d("segmento",z.value),d("diretoria",K.value),d("gerencia",L.value),d("agencia",J.value),d("ggestao",i.value),d("gerente",_.value),d("familia",T.value),d("indicador",S.value),d("subindicador",A.value),d("status",Y.value),y(x.value)},Le=()=>{Ae(),T.value="",S.value="",A.value="",Y.value="todos",re.value="mensal",x.value=he("mensal",x.value),xe(),q(),y(x.value)};return Xe(()=>x.value,a=>{y(a)},{deep:!0}),(a,n)=>(O(),k("section",ga,[n[13]||(n[13]=o("header",{class:"card__header"},[o("div",{class:"filters-hero"},[o("div",{class:"title-subtitle"},[o("h2",null,"POBJ Produções"),o("p",{class:"muted"},"Acompanhe dados atualizados de performance.")])])],-1)),o("div",va,[o("div",ma,[n[0]||(n[0]=o("label",null,"Segmento",-1)),f(V,{id:"f-segmento","model-value":l(z),options:[{id:"",nome:"Todos"},...Array.isArray(l(p))?l(p):[]],placeholder:"Todos",label:"Segmento",disabled:l(m),"onUpdate:modelValue":l(_e)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),o("div",fa,[n[1]||(n[1]=o("label",null,"Diretoria",-1)),f(V,{id:"f-diretoria","model-value":l(K),options:[{id:"",nome:"Todas"},...Array.isArray(l(G))?l(G):[]],placeholder:"Todas",label:"Diretoria",disabled:l(m),"onUpdate:modelValue":l(Se)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),o("div",pa,[n[2]||(n[2]=o("label",null,"Regional",-1)),f(V,{id:"f-gerencia","model-value":l(L),options:[{id:"",nome:"Todas"},...Array.isArray(l(E))?l(E):[]],placeholder:"Todas",label:"Regional",disabled:l(m),"onUpdate:modelValue":l(Ie)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),o("div",ba,[f(te,{id:"btn-filtrar",variant:"primary",disabled:s.value,onClick:Ke},{default:ae(()=>[f(ne,{name:"search",size:16,color:"white"}),n[3]||(n[3]=ve(" Filtrar ",-1))]),_:1},8,["disabled"]),f(te,{id:"btn-limpar",variant:"secondary",onClick:Le},{default:ae(()=>[f(ne,{name:"x",size:16}),n[4]||(n[4]=ve(" Limpar filtros ",-1))]),_:1})])]),g.value?(O(),k("div",ha,[f(te,{id:"btn-abrir-filtros",variant:"info","aria-expanded":u.value,"aria-controls":"advanced-filters",onClick:Q,onKeydown:[W(Z(Q,["prevent"]),["enter"]),W(Z(Q,["prevent"]),["space"])]},{default:ae(()=>[f(ne,{name:"chevron-down",size:16,class:oe({rotated:u.value})},null,8,["class"]),o("span",null,Qe(u.value?"Fechar filtros avançados":"Abrir filtros avançados"),1)]),_:1},8,["aria-expanded","onKeydown"])])):le("",!0),o("section",{id:"advanced-filters",class:oe(["adv",{"is-open":u.value}]),"aria-hidden":!u.value,"aria-labelledby":"btn-abrir-filtros",role:"region"},[o("div",Sa,[o("div",Ia,[n[5]||(n[5]=o("label",null,"Agência",-1)),f(V,{id:"f-agencia","model-value":l(J),options:[{id:"",nome:"Todas"},...Array.isArray(l(D))?l(D):[]],placeholder:"Todas",label:"Agência",disabled:l(m),"onUpdate:modelValue":l(ye)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),o("div",ya,[n[6]||(n[6]=o("label",null,"Gerente de gestão",-1)),f(V,{id:"f-gerente-gestao","model-value":l(i),options:[{id:"",nome:"Todos"},...Array.isArray(l($))?l($):[]],placeholder:"Todos",label:"Gerente de gestão",disabled:l(m),"onUpdate:modelValue":l(Ce)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),o("div",Ca,[n[7]||(n[7]=o("label",null,"Gerente",-1)),f(V,{id:"f-gerente","model-value":l(_),options:[{id:"",nome:"Todos"},...Array.isArray(l(se))?l(se):[]],placeholder:"Todos",label:"Gerente",disabled:l(m),"onUpdate:modelValue":l(Te)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),o("div",Ta,[n[8]||(n[8]=o("label",null,"Família",-1)),f(V,{id:"f-secao","model-value":T.value,options:[{id:"",nome:"Selecione..."},...R.value],placeholder:"Selecione...",label:"Família",disabled:l(m),"onUpdate:modelValue":we},null,8,["model-value","options","disabled"])]),o("div",Aa,[n[9]||(n[9]=o("label",null,"Indicadores",-1)),f(V,{id:"f-familia","model-value":S.value,options:[{id:"",nome:"Selecione..."},...Ve.value],placeholder:"Selecione...",label:"Indicadores",disabled:l(m)||!T.value,"onUpdate:modelValue":ke},null,8,["model-value","options","disabled"])]),o("div",Fa,[n[10]||(n[10]=o("label",null,"Subindicador",-1)),f(V,{id:"f-produto","model-value":A.value,options:[{id:"",nome:"Selecione..."},...de.value],placeholder:"Selecione...",label:"Subindicador",disabled:l(m)||!S.value||!Ue.value,"onUpdate:modelValue":Oe},null,8,["model-value","options","disabled"])]),o("div",Va,[n[11]||(n[11]=o("label",null,"Status dos indicadores",-1)),f(me,{id:"f-status-kpi","model-value":Y.value,options:Ee.value,placeholder:"Todos",label:"Status dos indicadores",disabled:l(m),"onUpdate:modelValue":Ne},null,8,["model-value","options","disabled"])]),o("div",Ua,[n[12]||(n[12]=o("label",null,"Visão acumulada",-1)),f(me,{id:"f-visao","model-value":l(re),options:Pe.value,placeholder:"Mensal",label:"Visão acumulada",disabled:l(m),"onUpdate:modelValue":ze},null,8,["model-value","options","disabled"])])])],10,_a)]))}}),$a=pe(wa,[["__scopeId","data-v-a6fc3c1d"]]);export{$a as default};
