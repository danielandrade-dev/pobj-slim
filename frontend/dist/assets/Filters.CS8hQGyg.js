import{a as Le,A as Ye,r as ue,b as m,c as h,d as fe,e as k,o as O,m as He,w as j,f as W,g as te,n as le,h as ce,_ as pe,u as je,i as We,j as Ze,k as qe,l as Je,p as o,q as f,s as l,S as V,t as ee,v as ge,I as ae,x as Xe,y as me}from"./index.CrVlIMw6.js";async function Qe(){return(await Le(Ye.INIT)).data??null}const ve=m(null),ne=m(!1);let E=null;function ea(){const e=async()=>E||(ne.value=!0,E=Qe().then(t=>(t&&(ve.value=t),t)).finally(()=>{ne.value=!1,E=null}),E);return{initData:ue(ve),isLoading:ue(ne),loadInit:e}}const I=e=>e==null||e===""?"":String(e).trim(),aa=(e,t)=>!e&&!t?"":e?!t||t===e?e:`${e} - ${t}`:t,na=(e,t)=>!e&&!t?"":e?!t||t===e?e:`${e} - ${t}`:t,M=(e,t)=>{const r=String(e.nome??e.label??"").trim();let u="",g;return t==="ggestao"||t==="gerente"?(g=I(e.funcional??""),u=I(e.id??"")):(u=I(e.id??e.codigo??e.id_diretoria??e.id_regional??e.id_agencia??""),g=e.funcional?I(e.funcional):void 0),{id:u,nome:t==="ggestao"||t==="gerente"?na(g||u,r):aa(u,r),id_segmento:I(e.segmento_id??e.id_segmento??e.idSegmento),id_diretoria:I(e.diretoria_id??e.id_diretoria??e.idDiretoria),id_regional:I(e.regional_id??e.id_regional??e.idRegional??e.gerencia_id??e.gerenciaId),id_agencia:I(e.agencia_id??e.id_agencia??e.idAgencia),id_gestor:I(e.id_gestor??e.idGestor??e.gerente_gestao_id??e.gerenteGestaoId),funcional:g}};function ia(e){const t={segmento:m(""),diretoria:m(""),gerencia:m(""),agencia:m(""),ggestao:m(""),gerente:m("")},r=h(()=>e.value?{segmentos:(e.value.segmentos??[]).map(i=>M(i,"segmento")),diretorias:(e.value.diretorias??[]).map(i=>M(i,"diretoria")),regionais:(e.value.regionais??[]).map(i=>M(i,"regional")),agencias:(e.value.agencias??[]).map(i=>M(i,"agencia")),ggestoes:(e.value.gerentes_gestao??[]).map(i=>M(i,"ggestao")),gerentes:(e.value.gerentes??[]).map(i=>M(i,"gerente"))}:null),u=h(()=>{if(!r.value)return null;const i=_=>Object.fromEntries((_??[]).map(p=>[I(p.id),p]));return{segmento:i(r.value.segmentos),diretoria:i(r.value.diretorias),gerencia:i(r.value.regionais),agencia:i(r.value.agencias),ggestao:i(r.value.ggestoes),gerente:i(r.value.gerentes)}}),g={segmento:null,diretoria:"id_segmento",gerencia:"id_diretoria",agencia:"id_regional",ggestao:"id_agencia",gerente:"id_gestor"},d={segmento:null,diretoria:"segmento",gerencia:"diretoria",agencia:"gerencia",ggestao:"agencia",gerente:"ggestao"};function c(i,_){if(!_)return;const p=d[i],B=g[i];if(!p||!B)return;const G=u.value?.[i]?.[I(_)];if(!G)return;const D=I(G[B]??"");if(!D)return;const $=u.value?.[p]?.[D];$&&(t[p].value=$.id,console.debug("[hierarchy] autoFillParent:",{childField:i,childValue:_,parentField:p,parentId:D}),c(p,$.id))}const C=["segmento","diretoria","gerencia","agencia","ggestao","gerente"];function v(i){let _=!1;for(const p of C)_&&(t[p].value=""),p===i&&(_=!0)}function s(i,_){t[i].value=I(_),v(i),c(i,t[i].value)}const y=h(()=>r.value?.segmentos??[]),Z=h(()=>r.value?.diretorias??[]),P=h(()=>r.value?.regionais??[]),N=h(()=>r.value?.agencias??[]),z=h(()=>r.value?.ggestoes??[]),K=h(()=>r.value?.gerentes??[]);return{...t,segmentos:y,diretorias:Z,regionais:P,agencias:N,gerentesGestao:z,gerentes:K,handleSegmentoChange:i=>s("segmento",i),handleDiretoriaChange:i=>s("diretoria",i),handleGerenciaChange:i=>s("gerencia",i),handleAgenciaChange:i=>s("agencia",i),handleGerenteGestaoChange:i=>s("ggestao",i),handleGerenteChange:i=>s("gerente",i),clearAll:()=>{for(const i of C)t[i].value=""}}}const be=[{value:"mensal",label:"Mensal",monthsBack:0},{value:"semestral",label:"Semestral",monthsBack:5},{value:"anual",label:"Anual",monthsBack:11}];function ta(e,t){const u=new Date().toISOString().split("T")[0],g=t||u,d=new Date(g+"T00:00:00Z");if(isNaN(d.getTime())){const s=new Date,y=s.toISOString().split("T")[0];return{start:`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-01`,end:y||`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}-${String(s.getDate()).padStart(2,"0")}`}}let c;if(e==="anual")c=new Date(Date.UTC(d.getUTCFullYear(),0,1));else if(e==="mensal")c=new Date(Date.UTC(d.getUTCFullYear(),d.getUTCMonth(),1));else{const s=be.find(y=>y.value===e)?.monthsBack||5;c=new Date(Date.UTC(d.getUTCFullYear(),d.getUTCMonth()-s,1))}const C=c.toISOString().split("T")[0]||"",v=d.toISOString().split("T")[0]||"";return{start:C,end:v}}function he(e,t,r){if(e==="mensal"){const u=new Date().toISOString().split("T")[0]||"",d=r||t.end||u||u,c=new Date(d+"T00:00:00Z");return{start:new Date(Date.UTC(c.getUTCFullYear(),c.getUTCMonth(),1)).toISOString().split("T")[0]||"",end:d}}return ta(e,t.end)}function la(e,t){const r=m("mensal");return{accumulatedView:r,handleViewChange:g=>{r.value=g;const d=he(g,e.value);t(d)},options:be}}const oa=["type","disabled","aria-busy","aria-disabled"],sa={key:0,class:"btn__spinner","aria-hidden":"true"},da={key:2},ra={key:3,class:"btn__loading-text","aria-live":"polite","aria-atomic":"true"},ua=fe({__name:"Button",props:{variant:{default:"secondary"},type:{default:"button"},disabled:{type:Boolean,default:!1},icon:{default:void 0},loading:{type:Boolean,default:!1}},setup(e){const t=e,r=m(null),u=g=>{if(t.disabled||t.loading)return;const d=g.currentTarget,c=document.createElement("span"),C=Math.max(d.clientWidth,d.clientHeight),v=C/2,s=d.getBoundingClientRect();c.style.width=c.style.height=`${C}px`,c.style.left=`${g.clientX-s.left-v}px`,c.style.top=`${g.clientY-s.top-v}px`,c.classList.add("ripple");const y=d.getElementsByClassName("ripple")[0];y&&y.remove(),d.appendChild(c),setTimeout(()=>{c.remove()},600)};return(g,d)=>(O(),k("button",He({ref_key:"buttonRef",ref:r,type:e.type,disabled:e.disabled||e.loading,class:["btn",`btn--${e.variant}`,{"btn--loading":e.loading}],"aria-busy":e.loading,"aria-disabled":e.disabled||e.loading},g.$attrs,{onClick:u,onKeydown:[d[0]||(d[0]=j(W(c=>!e.disabled&&!e.loading&&u(c),["prevent"]),["enter"])),d[1]||(d[1]=j(W(c=>!e.disabled&&!e.loading&&u(c),["prevent"]),["space"]))]}),[e.loading?(O(),k("span",sa)):te("",!0),e.icon&&!e.loading?(O(),k("i",{key:1,class:le(e.icon),"aria-hidden":"true"},null,2)):te("",!0),e.loading?(O(),k("span",ra,[ce(g.$slots,"default",{},void 0)])):(O(),k("span",da,[ce(g.$slots,"default",{},void 0)]))],16,oa))}}),ie=pe(ua,[["__scopeId","data-v-a56e4887"]]),ca={class:"card card--filters"},ga={class:"filters"},ma={class:"filters__group"},va={class:"filters__group"},fa={class:"filters__group"},pa={class:"filters__actions"},ba={key:0,class:"filters__more filters__more--center"},ha=["aria-hidden"],_a={class:"adv__grid"},Sa={class:"filters__group"},Ia={class:"filters__group"},ya={class:"filters__group"},Ca={class:"filters__group"},Ta={class:"filters__group"},Aa={class:"filters__group"},Fa={class:"filters__group"},Va={class:"filters__group"},Ua=fe({__name:"Filters",setup(e){const t=je(),r=h(()=>t.name==="Simuladores"),u=m(!1),g=m(!0),{initData:d,isLoading:c,loadInit:C}=ea(),v=c,{updateFilter:s,updatePeriod:y,clearFilters:Z,triggerFilter:P}=We(),{segmento:N,diretoria:z,gerencia:K,agencia:q,ggestao:i,gerente:_,segmentos:p,diretorias:B,regionais:G,agencias:D,gerentesGestao:$,gerentes:oe,handleSegmentoChange:_e,handleDiretoriaChange:Se,handleGerenciaChange:Ie,handleAgenciaChange:ye,handleGerenteGestaoChange:Ce,handleGerenteChange:Te,clearAll:Ae}=ia(d),R=m([]),U=m([]),J=m([]),Fe=m([]),T=m(""),S=m(""),A=m(""),L=m("todos"),Ve=h(()=>{if(!T.value)return U.value;const a=String(T.value).trim();return U.value.filter(n=>(n.id_familia?String(n.id_familia).trim():"")===a)}),se=h(()=>{if(!S.value)return[];const a=String(S.value).trim();return J.value.filter(n=>(n.id_indicador?String(n.id_indicador).trim():"")===a)}),Ue=h(()=>se.value.length>0),Y=(a,n)=>{if(!a)return null;const b=String(a).trim();return n.find(w=>String(w.id).trim()===b)||null},we=a=>{if(T.value=a,!a)S.value="",A.value="";else if(S.value){const n=Y(S.value,U.value),b=String(a).trim();(n?.id_familia?String(n.id_familia).trim():"")!==b&&(S.value="",A.value="")}},ke=a=>{if(S.value=a,A.value="",a){const n=Y(a,U.value);if(n?.id_familia){const b=String(n.id_familia).trim();R.value.some(F=>String(F.id).trim()===b)&&(T.value=b)}}else S.value="",A.value=""},Oe=a=>{if(A.value=a,a){const n=Y(a,J.value);if(n?.id_indicador){const b=String(n.id_indicador).trim();if(U.value.some(F=>String(F.id).trim()===b)){S.value=b;const F=Y(b,U.value);if(F?.id_familia){const Q=String(F.id_familia).trim();R.value.some(Re=>String(Re.id).trim()===Q)&&(T.value=Q)}}}}else A.value=""},De=a=>{const n=String(a.id||a.codigo||a.id_diretoria||a.id_regional||a.id_agencia||a.funcional||a.subId||a.subindicadorId||"").trim(),b=String(a.label||a.nome||n).trim(),w=a.id_familia??a.idFamilia??a.familia_id??a.familiaId,F=a.id_indicador??a.idIndicador??a.indicador_id??a.indicadorId??a.produtoId??a.produto_id;return{id:n,nome:b,id_familia:w?String(w).trim():void 0,id_indicador:F?String(F).trim():void 0}},H=a=>Array.isArray(a)?a.map(De).filter(n=>n.id):[],$e=async()=>{try{const a=await C();a&&(R.value=H(a.familias||[]),U.value=H(a.indicadores||[]),J.value=H(a.subindicadores||[]),Fe.value=H(a.status_indicadores||[]))}catch(a){console.error("Erro ao carregar estrutura:",a)}},{period:x,updatePeriod:xe}=Ze(),{accumulatedView:de,handleViewChange:Me,options:Be}=la(x,xe),Ge=h(()=>[{id:"todos",nome:"Todos"},{id:"atingidos",nome:"Atingidos"},{id:"nao",nome:"Não atingidos"}]),Ee=h(()=>Be.map(a=>({id:a.value,nome:a.label}))),Pe=a=>{L.value=a},Ne=a=>{Me(a)};qe(()=>{$e(),re(),P()});const X=()=>{u.value=!u.value},ze=()=>{re(),P()},re=()=>{s("segmento",N.value),s("diretoria",z.value),s("gerencia",K.value),s("agencia",q.value),s("ggestao",i.value),s("gerente",_.value),s("familia",T.value),s("indicador",S.value),s("subindicador",A.value),s("status",L.value),y(x.value)},Ke=()=>{Ae(),T.value="",S.value="",A.value="",L.value="todos",de.value="mensal",x.value=he("mensal",x.value),Z(),y(x.value)};return Je(()=>x.value,a=>{y(a)},{deep:!0}),(a,n)=>(O(),k("section",ca,[n[13]||(n[13]=o("header",{class:"card__header"},[o("div",{class:"filters-hero"},[o("div",{class:"title-subtitle"},[o("h2",null,"POBJ Produções"),o("p",{class:"muted"},"Acompanhe dados atualizados de performance.")])])],-1)),o("div",ga,[o("div",ma,[n[0]||(n[0]=o("label",null,"Segmento",-1)),f(V,{id:"f-segmento","model-value":l(N),options:[{id:"",nome:"Todos"},...Array.isArray(l(p))?l(p):[]],placeholder:"Todos",label:"Segmento",disabled:l(v),"onUpdate:modelValue":l(_e)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),o("div",va,[n[1]||(n[1]=o("label",null,"Diretoria",-1)),f(V,{id:"f-diretoria","model-value":l(z),options:[{id:"",nome:"Todas"},...Array.isArray(l(B))?l(B):[]],placeholder:"Todas",label:"Diretoria",disabled:l(v),"onUpdate:modelValue":l(Se)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),o("div",fa,[n[2]||(n[2]=o("label",null,"Regional",-1)),f(V,{id:"f-gerencia","model-value":l(K),options:[{id:"",nome:"Todas"},...Array.isArray(l(G))?l(G):[]],placeholder:"Todas",label:"Regional",disabled:l(v),"onUpdate:modelValue":l(Ie)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),o("div",pa,[f(ie,{id:"btn-filtrar",variant:"primary",disabled:r.value,onClick:ze},{default:ee(()=>[f(ae,{name:"search",size:16,color:"white"}),n[3]||(n[3]=ge(" Filtrar ",-1))]),_:1},8,["disabled"]),f(ie,{id:"btn-limpar",variant:"secondary",onClick:Ke},{default:ee(()=>[f(ae,{name:"x",size:16}),n[4]||(n[4]=ge(" Limpar filtros ",-1))]),_:1})])]),g.value?(O(),k("div",ba,[f(ie,{id:"btn-abrir-filtros",variant:"info","aria-expanded":u.value,"aria-controls":"advanced-filters",onClick:X,onKeydown:[j(W(X,["prevent"]),["enter"]),j(W(X,["prevent"]),["space"])]},{default:ee(()=>[f(ae,{name:"chevron-down",size:16,class:le({rotated:u.value})},null,8,["class"]),o("span",null,Xe(u.value?"Fechar filtros avançados":"Abrir filtros avançados"),1)]),_:1},8,["aria-expanded","onKeydown"])])):te("",!0),o("section",{id:"advanced-filters",class:le(["adv",{"is-open":u.value}]),"aria-hidden":!u.value,"aria-labelledby":"btn-abrir-filtros",role:"region"},[o("div",_a,[o("div",Sa,[n[5]||(n[5]=o("label",null,"Agência",-1)),f(V,{id:"f-agencia","model-value":l(q),options:[{id:"",nome:"Todas"},...Array.isArray(l(D))?l(D):[]],placeholder:"Todas",label:"Agência",disabled:l(v),"onUpdate:modelValue":l(ye)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),o("div",Ia,[n[6]||(n[6]=o("label",null,"Gerente de gestão",-1)),f(V,{id:"f-gerente-gestao","model-value":l(i),options:[{id:"",nome:"Todos"},...Array.isArray(l($))?l($):[]],placeholder:"Todos",label:"Gerente de gestão",disabled:l(v),"onUpdate:modelValue":l(Ce)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),o("div",ya,[n[7]||(n[7]=o("label",null,"Gerente",-1)),f(V,{id:"f-gerente","model-value":l(_),options:[{id:"",nome:"Todos"},...Array.isArray(l(oe))?l(oe):[]],placeholder:"Todos",label:"Gerente",disabled:l(v),"onUpdate:modelValue":l(Te)},null,8,["model-value","options","disabled","onUpdate:modelValue"])]),o("div",Ca,[n[8]||(n[8]=o("label",null,"Família",-1)),f(V,{id:"f-secao","model-value":T.value,options:[{id:"",nome:"Selecione..."},...R.value],placeholder:"Selecione...",label:"Família",disabled:l(v),"onUpdate:modelValue":we},null,8,["model-value","options","disabled"])]),o("div",Ta,[n[9]||(n[9]=o("label",null,"Indicadores",-1)),f(V,{id:"f-familia","model-value":S.value,options:[{id:"",nome:"Selecione..."},...Ve.value],placeholder:"Selecione...",label:"Indicadores",disabled:l(v)||!T.value,"onUpdate:modelValue":ke},null,8,["model-value","options","disabled"])]),o("div",Aa,[n[10]||(n[10]=o("label",null,"Subindicador",-1)),f(V,{id:"f-produto","model-value":A.value,options:[{id:"",nome:"Selecione..."},...se.value],placeholder:"Selecione...",label:"Subindicador",disabled:l(v)||!S.value||!Ue.value,"onUpdate:modelValue":Oe},null,8,["model-value","options","disabled"])]),o("div",Fa,[n[11]||(n[11]=o("label",null,"Status dos indicadores",-1)),f(me,{id:"f-status-kpi","model-value":L.value,options:Ge.value,placeholder:"Todos",label:"Status dos indicadores",disabled:l(v),"onUpdate:modelValue":Pe},null,8,["model-value","options","disabled"])]),o("div",Va,[n[12]||(n[12]=o("label",null,"Visão acumulada",-1)),f(me,{id:"f-visao","model-value":l(de),options:Ee.value,placeholder:"Mensal",label:"Visão acumulada",disabled:l(v),"onUpdate:modelValue":Ne},null,8,["model-value","options","disabled"])])])],10,ha)]))}}),Da=pe(Ua,[["__scopeId","data-v-ee492c4e"]]);export{Da as default};
