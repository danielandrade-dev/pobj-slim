import{b as Q,r as K,w as da,y as aa,m as f,q as a,k as F,o as y,e as D,j as H,u as l,t as N,C as I,E as n,L as U,M as ca,F as E,D as X,A as la,v as oa,B as na}from"./vendor.Mb-DmQZ9.js";import{_ as O,I as L}from"./index.BhrQwIPG.js";import{u as sa}from"./useResumoData.CMtZmfDd.js";import{u as Y}from"./useGlobalFilters.D0Gs3l7g.js";import{f as ua,a as P,b as _a,c as ma,d as B,e as V,g as pa,h as J}from"./formatUtils.SsKD9Isb.js";import{u as va}from"./useCalendarioCache.BKWrykFm.js";import{f as ra}from"./calendarioService.XaSIw3de.js";import"./pdf-vendor.BFzd3waL.js";import"./icons-vendor.vP8HAgRq.js";import"./vue-router.BEbJbLaE.js";const ga={class:"resumo-mode"},ha={class:"resumo-mode__toggle",role:"group","aria-label":"Alterar visão do resumo"},fa={class:"segmented"},ya=["aria-pressed"],ba=["aria-pressed"],$a=Q({__name:"ResumoModeToggle",props:{modelValue:{}},emits:["update:modelValue"],setup(R,{emit:w}){const b=R,p=w,$=K(b.modelValue||"cards");da(()=>b.modelValue,i=>{i&&(i==="cards"||i==="legacy")&&($.value=i)});const z=i=>{$.value=i,p("update:modelValue",i),typeof window<"u"&&localStorage.setItem("resumo-mode",i)};return aa(()=>{if(typeof window<"u"&&!b.modelValue){const i=localStorage.getItem("resumo-mode");i&&(i==="cards"||i==="legacy")&&($.value=i,p("update:modelValue",i))}else b.modelValue&&($.value=b.modelValue)}),(i,g)=>(y(),f("div",ga,[a("div",ha,[a("div",fa,[a("button",{type:"button",class:F(["seg-btn",{"is-active":$.value==="cards"}]),"aria-pressed":$.value==="cards",onClick:g[0]||(g[0]=v=>z("cards"))}," Visão por cards ",10,ya),a("button",{type:"button",class:F(["seg-btn",{"is-active":$.value==="legacy"}]),"aria-pressed":$.value==="legacy",onClick:g[1]||(g[1]=v=>z("legacy"))}," Visão clássica ",10,ba)])])]))}}),ka=O($a,[["__scopeId","data-v-446d22e4"]]);function ia(R,w){const b=sa(R,w),p=D(()=>b.buildFilters()),$=D(()=>{const z=new Map;return b.produtos.value.forEach(i=>{const g=i.id_familia||"sem-familia",v=i.familia||"Sem Família",h=i.id_indicador||i.id;if(!h)return;z.has(g)||z.set(g,new Map);const c=z.get(g);if(c.has(h)){const _=c.get(h);_.meta=(_.meta||0)+(i.meta||0),_.realizado=(_.realizado||0)+(i.realizado||0),_.pontos=(_.pontos||0)+(i.pontos||0),_.pontosMeta=(_.pontosMeta||0)+(i.pontos_meta||i.peso||0),i.ultima_atualizacao&&(!_.ultimaAtualizacao||i.ultima_atualizacao>_.ultimaAtualizacao)&&(_.ultimaAtualizacao=i.ultima_atualizacao);const r=_.meta||0,m=_.realizado||0;_.ating=r>0?m/r:0,_.atingido=r>0?m/r>=1:!1}else{const _=i.meta||0,r=i.realizado||0,m={id:h,nome:i.indicador||"Indicador",familiaId:g,familiaNome:v,indicadorId:h,indicadorNome:i.indicador||"Indicador",metrica:i.metrica||"valor",peso:i.peso||0,pontosMeta:i.pontos_meta||i.peso||0,meta:_,realizado:r,pontos:i.pontos||0,atingido:_>0?r/_>=1:!1,ating:_>0?r/_:0,ultimaAtualizacao:i.ultima_atualizacao};c.set(h,m)}}),Array.from(z.entries()).map(([i,g])=>{const v=Array.from(g.values()),h=v.reduce((e,s)=>e+(s.pontosMeta||0),0),c=v.reduce((e,s)=>e+Math.max(0,s.pontos||0),0),_=v.reduce((e,s)=>e+(s.meta||0),0),r=v.reduce((e,s)=>e+(s.realizado||0),0),m=_>0?r/_*100:0;return{id:i,label:v[0]?.familiaNome||"Sem Família",items:v,totals:{pontosTotal:h,pontosHit:c,metaTotal:_,realizadoTotal:r,atingPct:m}}})});return{produtos:b.produtos,produtosPorFamilia:$,loading:b.loading,error:b.error,loadProdutos:b.loadResumo,produtoFilters:p}}function xa(R,w){const{produtosPorFamilia:b}=ia(R,w),p=sa(R,w),$=D(()=>{const i=p.variavel.value||[];if(!i.length)return{varPossivel:null,varAtingido:null};const g=i.reduce((v,h)=>{const c=Number(h.variavel_meta)||0,_=Number(h.variavel_real)||0;return v.meta+=c,v.real+=_,v},{meta:0,real:0});return{varPossivel:g.meta,varAtingido:g.real}});return{summary:D(()=>{const i=b.value||[];let g=0,v=0,h=0,c=0;return i.forEach(_=>{_.items.forEach(r=>{v++,r.atingido&&g++;const m=r.pontosMeta||0,e=Math.max(0,r.pontos||0);c+=m,h+=Math.min(e,m)})}),{indicadoresAtingidos:g,indicadoresTotal:v,pontosAtingidos:h,pontosPossiveis:c,varPossivel:$.value.varPossivel,varAtingido:$.value.varAtingido}})}}const Ma={id:"kpi-summary",class:"kpi-summary"},wa={key:0,class:"kpi-pill"},za={class:"kpi-strip__main"},Aa={class:"kpi-icon"},Pa={class:"kpi-strip__text"},Fa={class:"kpi-strip__stats"},Ra={class:"kpi-stat"},Ta={class:"kpi-stat"},Na=["aria-valuenow","aria-label","aria-valuetext"],Ca={class:"hitbar__thumb"},Sa={class:"hitbar__pct"},Va={key:1,class:"kpi-pill"},Da={class:"kpi-strip__main"},Ia={class:"kpi-icon"},Ba={class:"kpi-strip__text"},Ea={class:"kpi-strip__stats"},ja={class:"kpi-stat"},Ha={class:"kpi-stat"},La=["aria-valuenow"],qa={class:"hitbar__thumb"},Ua={class:"hitbar__pct"},Ka={class:"kpi-pill"},Qa={class:"kpi-strip__main"},Oa={class:"kpi-icon"},Wa={class:"kpi-strip__text"},Ga={class:"kpi-strip__stats"},Ja={class:"kpi-stat"},Xa={class:"kpi-stat"},Ya=["aria-valuenow","aria-valuetext"],Za={class:"hitbar__thumb"},as={class:"hitbar__pct"},ss=Q({__name:"ResumoKPI",setup(R){const{filterState:w,period:b}=Y(),{summary:p}=xa(w,b),$=(h,c)=>h==="brl"?ua(c):h==="pts"?P(c):_a(c),z=h=>h<50?"hitbar--low":h<100?"hitbar--warn":"hitbar--ok",i=D(()=>p.value.indicadoresTotal===0?0:p.value.indicadoresAtingidos/p.value.indicadoresTotal*100),g=D(()=>p.value.pontosPossiveis===0?0:p.value.pontosAtingidos/p.value.pontosPossiveis*100),v=D(()=>{const h=p.value.varPossivel??0,c=p.value.varAtingido??0;if(h===0||!Number.isFinite(h)||!Number.isFinite(c))return 0;const _=c/h*100;return Math.max(0,Math.min(100,_))});return(h,c)=>(y(),f("div",Ma,[l(p).indicadoresTotal>0||l(p).pontosPossiveis>0?(y(),f("div",wa,[a("div",za,[a("span",Aa,[N(L,{name:"list-check",size:22})]),a("div",Pa,[c[2]||(c[2]=a("span",{class:"kpi-strip__label"},"Indicadores",-1)),a("div",Fa,[a("span",Ra,[c[0]||(c[0]=I(" Atg: ",-1)),a("strong",null,n($("int",l(p).indicadoresAtingidos)),1)]),a("span",Ta,[c[1]||(c[1]=I(" Total: ",-1)),a("strong",null,n($("int",l(p).indicadoresTotal)),1)])])])]),a("div",{class:F(["hitbar",z(i.value)]),role:"progressbar","aria-valuenow":i.value,"aria-valuemin":"0","aria-valuemax":"100","aria-label":`Atingimento de indicadores: ${i.value.toFixed(1)}%`,"aria-valuetext":`${i.value.toFixed(1)}% (${l(p).indicadoresAtingidos} de ${l(p).indicadoresTotal} indicadores)`},[a("span",{class:"hitbar__track",style:U({"--target":`${i.value.toFixed(2)}%`,"--thumb":`${i.value.toFixed(2)}%`})},[c[3]||(c[3]=a("span",{class:"hitbar__fill"},null,-1)),a("span",Ca,[a("span",Sa,n(i.value.toFixed(1))+"%",1)])],4)],10,Na)])):H("",!0),l(p).pontosPossiveis>0?(y(),f("div",Va,[a("div",Da,[a("span",Ia,[N(L,{name:"medal",size:22})]),a("div",Ba,[c[6]||(c[6]=a("span",{class:"kpi-strip__label"},"Pontos",-1)),a("div",Ea,[a("span",ja,[c[4]||(c[4]=I(" Atg: ",-1)),a("strong",null,n($("pts",l(p).pontosAtingidos)),1)]),a("span",Ha,[c[5]||(c[5]=I(" Total: ",-1)),a("strong",null,n($("pts",l(p).pontosPossiveis)),1)])])])]),a("div",{class:F(["hitbar",z(g.value)]),role:"progressbar","aria-valuenow":g.value,"aria-valuemin":"0","aria-valuemax":"100"},[a("span",{class:"hitbar__track",style:U({"--target":`${g.value.toFixed(2)}%`,"--thumb":`${g.value.toFixed(2)}%`})},[c[7]||(c[7]=a("span",{class:"hitbar__fill"},null,-1)),a("span",qa,[a("span",Ua,n(g.value.toFixed(1))+"%",1)])],4)],10,La)])):H("",!0),a("div",Ka,[a("div",Qa,[a("span",Oa,[N(L,{name:"cash",size:22})]),a("div",Wa,[c[10]||(c[10]=a("span",{class:"kpi-strip__label"},[I(" Variável "),a("span",{class:"kpi-label-emphasis"},"Estimada")],-1)),a("div",Ga,[a("span",Ja,[c[8]||(c[8]=I(" Atg: ",-1)),a("strong",null,n($("brl",l(p).varAtingido||0)),1)]),a("span",Xa,[c[9]||(c[9]=I(" Total: ",-1)),a("strong",null,n($("brl",l(p).varPossivel||0)),1)])])])]),a("div",{class:F(["hitbar",z(v.value)]),role:"progressbar","aria-valuenow":v.value,"aria-valuetext":`Variável Estimada: ${v.value.toFixed(1)}%`,"aria-valuemin":"0","aria-valuemax":"100"},[a("span",{class:"hitbar__track",style:U({"--target":`${Math.max(0,Math.min(100,v.value)).toFixed(2)}%`,"--thumb":`${Math.max(0,Math.min(100,v.value)).toFixed(2)}%`})},[c[11]||(c[11]=a("span",{class:"hitbar__fill"},null,-1)),a("span",Za,[a("span",as,n(v.value.toFixed(1))+"%",1)])],4)],10,Ya)])]))}}),ts=O(ss,[["__scopeId","data-v-c18e6632"]]);function es(){const R=K([]),{filterState:w,period:b}=Y(),p=sa(w,b),$=async()=>{await p.loadResumo()},z=D(()=>p.businessSnapshot.value);return{calendario:R,loading:p.loading,loadCalendario:$,getCurrentMonthBusinessSnapshot:z}}const os={id:"grid-familias"},is={key:0,class:"produtos-skeleton"},ls={key:0,class:"error-state"},ns={class:"fam-section__header"},rs={class:"fam-section__title"},ds={key:0,class:"fam-section__meta"},cs=["title"],us={class:"fam-section__grid"},_s=["data-prod-id","data-familia-id","data-familia-label","aria-label","onKeydown"],ms={class:"prod-card__title"},ps=["title"],vs=["aria-label","title","onMouseenter","onClick","onTouchstart"],gs={class:"prod-card__meta"},hs={class:"pill"},fs={class:"pill"},ys={class:"pill"},bs={class:"prod-card__kpis"},$s={class:"kv"},ks=["title"],xs={class:"kv"},Ms=["title"],ws={class:"prod-card__var"},zs={class:"prod-card__var-body"},As=["title"],Ps=["data-ratio","aria-valuenow","aria-label","aria-valuetext"],Fs=["title"],Rs={class:"prod-card__var-value"},Ts={class:"prod-card__foot"},Ns={key:0,class:"kpi-tip is-open",role:"dialog","aria-label":"Detalhes do indicador"},Cs={class:"row"},Ss={class:"row"},Vs={class:"row"},Ds={class:"row"},Is={class:"row"},Bs={class:"row"},Es={class:"row"},js={key:2,class:"empty-state"},Hs=Q({__name:"ProdutosCards",setup(R){const{filterState:w,period:b}=Y(),{produtosPorFamilia:p,loading:$,error:z}=ia(w,b),{getCurrentMonthBusinessSnapshot:i}=es(),{loadCalendario:g}=va(),v=K(null);aa(async()=>{await g()});const h=u=>{const t=d=>{d.target.closest(".prod-card")||u()};aa(()=>{document.addEventListener("click",t)}),la(()=>{document.removeEventListener("click",t)})},c=u=>{const t=d=>{d.key==="Escape"&&u()};aa(()=>{document.addEventListener("keydown",t)}),la(()=>{document.removeEventListener("keydown",t)})};h(()=>{v.value=null}),c(()=>{v.value=null});const _=(u,t)=>{Number.isFinite(t)||(t=0);const d=u?.toLowerCase()||"valor";return d==="perc"?`${t.toFixed(1)}%`:d==="qtd"?new Intl.NumberFormat("pt-BR",{maximumFractionDigits:0}).format(Math.round(t)):pa(Math.round(t))},r=u=>{const t=i.value,{total:d,elapsed:o,remaining:k}=t;let j=u.meta||0;const W=u.realizado||0;u.metrica?.toLowerCase()==="perc"&&(j=100);const G=Math.max(0,j-W),ta=k>0?G/k:0,q=(o>0?W/o:0)*(d||0),Z=d>0?j/d*o:0;return{diasTotais:d,diasDecorridos:o,diasRestantes:k,faltaTotal:_(u.metrica||"valor",G),necessarioPorDia:k>0?_(u.metrica||"valor",ta):"—",referenciaHoje:o>0?_(u.metrica||"valor",Z):"—",projecaoRitmoAtual:_(u.metrica||"valor",q)}},m=(u,t)=>{const d=u.closest(".prod-card");if(!d)return;const o=u.getBoundingClientRect(),k=d.getBoundingClientRect(),j=t.offsetWidth||320,W=t.offsetHeight||200,G=window.innerWidth,ta=window.innerHeight;let ea=o.bottom-k.top+8;o.bottom+W+12>ta&&(ea=o.top-k.top-W-8);let q=k.width-j-12;const Z=k.left+q;Z<12&&(q=12),Z+j>G-12&&(q=Math.max(12,G-12-k.left-j)),t.style.top=`${ea}px`,t.style.left=`${q}px`},e=(u,t)=>{t.stopPropagation(),v.value=u,requestAnimationFrame(()=>{const d=document.querySelector(`[data-prod-id="${u}"]`);if(!d)return;const o=d.querySelector(".badge"),k=d.querySelector(".kpi-tip");o&&k&&m(o,k)})},s=()=>{v.value=null},T=(u,t)=>{t.stopPropagation(),v.value===u?s():e(u,t)},A=u=>u<50?"badge--low":u<100?"badge--warn":"badge--ok",S=u=>u<50?"var--low":u<100?"var--warn":"var--ok",x=u=>{const t=u.meta||0,d=u.realizado||0;return t<=0?0:d/t*100},M=u=>{const t=u.pontosMeta||0,d=u.pontos||0;return t>0?d/t*100:0},C=u=>{if(!u)return"Valor";const t=u.toLowerCase();return t==="valor"?"Valor":t==="qtd"||t==="quantidade"?"Quantidade":"Percentual"};return(u,t)=>(y(),f("div",os,[l($)?(y(),f("div",is,[...t[0]||(t[0]=[ca('<div class="skeleton skeleton--section-title" style="height:28px;width:200px;margin-bottom:16px;border-radius:6px;" data-v-0ec0f9e5></div><div class="cards-grid" data-v-0ec0f9e5><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-0ec0f9e5></div><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-0ec0f9e5></div><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-0ec0f9e5></div><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-0ec0f9e5></div></div><div class="skeleton skeleton--section-title" style="height:28px;width:200px;margin:32px 0 16px;border-radius:6px;" data-v-0ec0f9e5></div><div class="cards-grid" data-v-0ec0f9e5><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-0ec0f9e5></div><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-0ec0f9e5></div><div class="skeleton skeleton--card" style="height:180px;border-radius:12px;" data-v-0ec0f9e5></div></div>',4)])])):(y(),f(E,{key:1},[l(z)?(y(),f("div",ls,[a("p",null,n(l(z)),1)])):l(p).length>0?(y(!0),f(E,{key:1},X(l(p),d=>(y(),f("div",{key:d.id,class:"fam-section"},[a("header",ns,[a("div",rs,[a("span",null,n(d.label),1),d.totals?(y(),f("small",ds,[a("span",{class:"fam-section__meta-item",title:`Pontos: ${l(P)(d.totals.pontosHit,{withUnit:!0})} / ${l(P)(d.totals.pontosTotal,{withUnit:!0})}`}," Pontos: "+n(l(P)(d.totals.pontosHit))+" / "+n(l(P)(d.totals.pontosTotal)),9,cs)])):H("",!0)])]),a("div",us,[(y(!0),f(E,null,X(d.items,o=>(y(),f("article",{key:o.id,class:F(["prod-card",{"is-tip-open":v.value===o.id}]),"data-prod-id":o.id,"data-familia-id":o.familiaId,"data-familia-label":o.familiaNome,role:"article","aria-label":`Produto: ${o.nome}`,tabindex:"0",onMouseleave:s,onKeydown:[oa(na(k=>e(o.id,k),["prevent"]),["enter"]),oa(na(k=>e(o.id,k),["prevent"]),["space"]),oa(s,["escape"])]},[a("div",ms,[N(L,{name:"chart-line",size:22,color:"#b30000",class:"prod-card__icon"}),a("span",{class:"prod-card__name has-ellipsis",title:o.nome},n(o.nome),9,ps),a("span",{class:F(["badge",A(x(o))]),"aria-label":`Atingimento: ${x(o).toFixed(1)}%`,title:`${x(o).toFixed(1)}%`,onMouseenter:k=>{k.stopPropagation(),e(o.id,k)},onClick:k=>{k.stopPropagation(),T(o.id,k)},onTouchstart:k=>{k.stopPropagation(),T(o.id,k)}},n(x(o)>=100?`${Math.round(x(o))}%`:`${x(o).toFixed(1)}%`),43,vs)]),a("div",gs,[a("span",hs," Pontos: "+n(l(P)(o.pontos||0))+" / "+n(l(P)(o.pontosMeta||0)),1),a("span",fs,"Peso: "+n(l(ma)(o.peso||0)),1),a("span",ys,n(C(o.metrica)),1)]),a("div",bs,[a("div",$s,[t[1]||(t[1]=a("small",null,"Meta",-1)),a("strong",{class:"has-ellipsis",title:l(B)(o.metrica,o.meta)},n(l(V)(o.metrica,o.meta)),9,ks)]),a("div",xs,[t[2]||(t[2]=a("small",null,"Realizado",-1)),a("strong",{class:"has-ellipsis",title:l(B)(o.metrica,o.realizado)},n(l(V)(o.metrica,o.realizado)),9,Ms)])]),a("div",ws,[t[3]||(t[3]=a("div",{class:"prod-card__var-head"},[a("small",null,"Atingimento de pontos")],-1)),a("div",zs,[a("span",{class:"prod-card__var-goal",title:l(P)(o.pontosMeta||0,{withUnit:!0})},n(l(P)(o.pontosMeta||0,{withUnit:!0})),9,As),a("div",{class:F(["prod-card__var-track",S(M(o))]),"data-ratio":M(o).toFixed(2),role:"progressbar","aria-valuemin":"0","aria-valuemax":"100","aria-valuenow":Math.round(M(o)),"aria-label":`Atingimento de pontos: ${M(o).toFixed(1)}%`,"aria-valuetext":`${M(o).toFixed(1)}% (${l(P)(o.pontos||0)} de ${l(P)(o.pontosMeta||0)})`},[a("span",{class:"prod-card__var-fill",style:U({"--target":`${M(o)}%`})},null,4),a("span",{class:"prod-card__var-label",style:U({"--target":`${M(o)}%`}),title:`Atingido: ${l(P)(o.pontos||0,{withUnit:!0})} · ${M(o).toFixed(1)}%`},[a("span",Rs,n(M(o).toFixed(1))+"%",1)],12,Fs)],10,Ps)])]),a("div",Ts," Atualizado em "+n(o.ultimaAtualizacao||"N/A"),1),v.value===o.id?(y(),f("div",Ns,[r(o)?(y(),f(E,{key:0},[t[11]||(t[11]=a("h5",null,"Projeção e metas",-1)),a("div",Cs,[t[4]||(t[4]=a("span",null,"Quantidade de dias úteis no mês",-1)),a("span",null,n(new Intl.NumberFormat("pt-BR").format(r(o).diasTotais)),1)]),a("div",Ss,[t[5]||(t[5]=a("span",null,"Dias úteis trabalhados",-1)),a("span",null,n(new Intl.NumberFormat("pt-BR").format(r(o).diasDecorridos)),1)]),a("div",Vs,[t[6]||(t[6]=a("span",null,"Dias úteis que faltam",-1)),a("span",null,n(new Intl.NumberFormat("pt-BR").format(r(o).diasRestantes)),1)]),a("div",Ds,[t[7]||(t[7]=a("span",null,"Falta para a meta",-1)),a("span",null,n(r(o).faltaTotal),1)]),a("div",Is,[t[8]||(t[8]=a("span",null,"Referência para hoje",-1)),a("span",null,n(r(o).referenciaHoje),1)]),a("div",Bs,[t[9]||(t[9]=a("span",null,"Meta diária necessária",-1)),a("span",null,n(r(o).necessarioPorDia),1)]),a("div",Es,[t[10]||(t[10]=a("span",null,"Projeção (ritmo atual)",-1)),a("span",null,n(r(o).projecaoRitmoAtual),1)])],64)):H("",!0)])):H("",!0)],42,_s))),128))])]))),128)):(y(),f("div",js,[...t[12]||(t[12]=[a("p",null,"Nenhum produto encontrado",-1)])]))],64))]))}}),Ls=O(Hs,[["__scopeId","data-v-0ec0f9e5"]]);function qs(){const{filterState:R,period:w}=Y(),b=sa(R,w),p=b.produtosMensais,$=b.loading,z=b.error,i=b.businessSnapshot,g=D(()=>{const v=new Map;p.value.forEach(s=>{const T=s.id_familia||"sem-familia",A=s.id_indicador||s.id;if(!A)return;v.has(T)||v.set(T,new Map);const S=v.get(T);if(S.has(A)){const x=S.get(A);!x.peso&&s.peso&&(x.peso=Number(s.peso)||0,x.pontosMeta=Number(s.pontos_meta??s.peso)||0),x.meta=(x.meta||0)+(s.meta||0),x.realizado=(x.realizado||0)+(s.realizado||0);const M=new Map;x.months.forEach(t=>{M.set(t.mes,{meta:t.meta,realizado:t.realizado})}),s.meses.forEach(t=>{const d=M.get(t.mes)||{meta:0,realizado:0};M.set(t.mes,{meta:d.meta+t.meta,realizado:d.realizado+t.realizado})}),x.months=Array.from(M.entries()).map(([t,d])=>({mes:t,meta:d.meta,realizado:d.realizado,atingimento:d.meta>0?d.realizado/d.meta*100:0}));const C=new Date().toISOString().slice(0,7),u=x.months.find(t=>t.mes===C);if(x.monthMeta=u?.meta||0,x.monthReal=u?.realizado||0,s.id_subindicador&&s.subindicador){x.children||(x.children=[]);const t={id:s.id_subindicador,nome:s.subindicador,metrica:s.metrica,peso:Number(s.peso)||0,pontosMeta:Number(s.pontos_meta??s.peso)||0,pontosBackend:s.pontos?Number(s.pontos):void 0,meta:s.meta||0,realizado:s.realizado||0,monthMeta:u?.meta||0,monthReal:u?.realizado||0,ultimaAtualizacao:s.ultima_atualizacao,months:s.meses};x.children.push(t)}}else{const x=new Date().toISOString().slice(0,7),M=s.meses.find(u=>u.mes===x),C={id:A,nome:s.indicador||"Indicador",metrica:s.metrica||"valor",peso:Number(s.peso)||0,pontosMeta:Number(s.pontos_meta??s.peso)||0,pontosBackend:s.pontos?Number(s.pontos):void 0,meta:s.meta||0,realizado:s.realizado||0,monthMeta:M?.meta||0,monthReal:M?.realizado||0,ultimaAtualizacao:s.ultima_atualizacao,months:s.meses,children:[]};if(s.id_subindicador&&s.subindicador){const u={id:s.id_subindicador,nome:s.subindicador,metrica:s.metrica,peso:Number(s.peso)||0,pontosMeta:Number(s.pontos_meta??s.peso)||0,pontosBackend:s.pontos?Number(s.pontos):void 0,meta:s.meta||0,realizado:s.realizado||0,monthMeta:M?.meta||0,monthReal:M?.realizado||0,ultimaAtualizacao:s.ultima_atualizacao,months:s.meses};C.children.push(u)}S.set(A,C)}});const h=new Map;p.value.forEach(s=>{s.id_familia&&!h.has(s.id_familia)&&h.set(s.id_familia,s.familia||"Sem Família")});const c=i.value,_=c.total||1,r=c.elapsed||0,m=c.remaining||0,e=s=>{const T=s.meta||0,A=s.realizado||0,S=s.pontosMeta||s.peso||0,x=_>0?T/_*r:0,M=Math.max(0,T-A),C=m>0?M/m:0,u=r>0?A/r*m+A:A;let t,d;s.pontosBackend!==void 0?(t=s.pontosBackend,d=t):(d=Math.min(S,A),t=Math.max(0,Math.min(S,d)));const o=T>0?A/T:0,k={...s,referenciaHoje:x,projecao:u,metaDiariaNecessaria:C,pontos:t,pontosBrutos:d,ating:o};return s.children&&s.children.length>0&&(k.children=s.children.map(e)),k};return Array.from(v.entries()).map(([s,T])=>{const A=Array.from(T.values()).map(e),S=A.reduce((t,d)=>t+(d.pontosMeta||0),0),x=A.reduce((t,d)=>t+(d.pontos||0),0),M=A.reduce((t,d)=>t+(d.meta||0),0),C=A.reduce((t,d)=>t+(d.realizado||0),0),u=M>0?C/M*100:0;return{id:s,label:h.get(s)||"Sem Família",items:A,totals:{pontosTotal:S,pontosHit:x,metaTotal:M,realizadoTotal:C,atingPct:u}}})});return{produtos:p,produtosPorFamilia:g,loading:$,error:z,loadProdutos:b.loadResumo}}const Us={class:"resumo-legacy"},Ks={key:0,class:"resumo-legacy__loading"},Qs={key:1,class:"resumo-legacy__error"},Os={key:2,class:"resumo-legacy__empty"},Ws={class:"resumo-legacy__head"},Gs={class:"resumo-legacy__heading"},Js={class:"resumo-legacy__title-row"},Xs={class:"resumo-legacy__name"},Ys={class:"resumo-legacy__section-actions"},Zs=["disabled","onClick"],at={class:"resumo-legacy__section-toggle-label"},st={class:"resumo-legacy__chips"},tt={class:"resumo-legacy__chip"},et=["title"],ot={class:"resumo-legacy__stats"},it={class:"resumo-legacy__stat"},lt={class:"resumo-legacy__stat-value"},nt={key:0,class:"resumo-legacy__stat"},rt={class:"resumo-legacy__stat-value"},dt={class:"resumo-legacy__stat"},ct={class:"resumo-legacy__stat-value"},ut={class:"resumo-legacy__table-wrapper"},_t={class:"resumo-legacy__table"},mt=["data-row-id"],pt={class:"resumo-legacy__col--prod"},vt={class:"resumo-legacy__prod"},gt=["aria-expanded","onClick"],ht=["title"],ft={key:1,class:"resumo-legacy__prod-name-wrapper"},yt=["title"],bt={class:"resumo-legacy__col--peso"},$t=["title"],kt=["title"],xt=["title"],Mt=["title"],wt=["title"],zt=["title"],At=["title"],Pt={class:"resumo-legacy__col--ating"},Ft={class:"resumo-legacy__ating",title:"Atingimento"},Rt=["aria-valuenow"],Tt={class:"resumo-legacy__ating-value"},Nt={class:"resumo-legacy__col--update"},Ct=["data-row-id"],St={class:"resumo-legacy__col--prod"},Vt={class:"resumo-legacy__prod"},Dt=["title"],It=["title"],Bt=["title"],Et=["title"],jt={class:"resumo-legacy__col--update"},Ht=Q({__name:"ResumoLegacy",setup(R){const{filterState:w,period:b}=Y();ia(w,b);const{produtosPorFamilia:p,loading:$,error:z}=qs(),i=K(new Set),g=K(new Set),v=_=>{i.value.has(_)?i.value.delete(_):i.value.add(_)},h=_=>{g.value.has(_)?g.value.delete(_):g.value.add(_)},c=_=>_.items.some(r=>r.children&&r.children.length>0);return(_,r)=>(y(),f("div",Us,[l($)?(y(),f("div",Ks," Carregando... ")):l(z)?(y(),f("div",Qs," Erro: "+n(l(z)),1)):!l(p)||l(p).length===0?(y(),f("div",Os," Nenhum dado disponível ")):(y(!0),f(E,{key:3},X(l(p),m=>(y(),f("section",{key:m.id,class:"resumo-legacy__section resumo-legacy__section--annual card card--legacy"},[a("header",Ws,[a("div",Gs,[a("div",Js,[a("span",Xs,n(m.label),1),a("div",Ys,[a("button",{type:"button",class:F(["resumo-legacy__section-toggle",{"is-disabled":!c(m)},{"is-expanded":g.value.has(m.id)}]),disabled:!c(m),onClick:e=>h(m.id)},[N(L,{name:"filter",size:16}),a("span",at,n(g.value.has(m.id)?"Recolher filtros":"Abrir todos os filtros"),1)],10,Zs)])]),a("div",st,[a("span",tt,[N(L,{name:"box-multiple",size:16}),I(" "+n(l(J)(m.items.length||0))+" indicadores ",1)]),a("span",{class:"resumo-legacy__chip",title:`Pontos: ${l(P)(m.totals.pontosHit,{withUnit:!0})} / ${l(P)(m.totals.pontosTotal,{withUnit:!0})}`}," Pontos "+n(l(J)(Math.round(m.totals.pontosHit)))+" / "+n(l(J)(Math.round(m.totals.pontosTotal))),9,et)])]),a("div",ot,[a("div",it,[r[0]||(r[0]=a("span",{class:"resumo-legacy__stat-label"},"Peso total",-1)),a("strong",lt,n(l(J)(Math.round(m.totals.pontosTotal))),1)]),m.totals.realizadoTotal>0?(y(),f("div",nt,[r[1]||(r[1]=a("span",{class:"resumo-legacy__stat-label"},"Realizado",-1)),a("strong",rt,n(l(V)("valor",m.totals.realizadoTotal)),1)])):H("",!0),a("div",dt,[r[2]||(r[2]=a("span",{class:"resumo-legacy__stat-label"},"Atingimento",-1)),a("strong",ct,n(m.totals.metaTotal>0?`${Math.max(0,Math.min(200,m.totals.atingPct)).toFixed(1)}%`:"—"),1)])])]),a("div",ut,[a("table",_t,[r[10]||(r[10]=a("thead",null,[a("tr",null,[a("th",{scope:"col"},"Subindicador"),a("th",{scope:"col",class:"resumo-legacy__col--peso"},"Peso"),a("th",{scope:"col"},"Métrica"),a("th",{scope:"col",class:"resumo-legacy__col--meta"},"Meta"),a("th",{scope:"col",class:"resumo-legacy__col--real"},"Realizado"),a("th",{scope:"col",class:"resumo-legacy__col--ref"},"Ref. do dia"),a("th",{scope:"col",class:"resumo-legacy__col--forecast"},"Forecast"),a("th",{scope:"col",class:"resumo-legacy__col--meta-dia"},"Meta diária nec."),a("th",{scope:"col",class:"resumo-legacy__col--pontos"},"Pontos"),a("th",{scope:"col",class:"resumo-legacy__col--ating"},"Ating."),a("th",{scope:"col",class:"resumo-legacy__col--update"},"Atualização")])],-1)),a("tbody",null,[(y(!0),f(E,null,X(m.items,e=>(y(),f(E,{key:e.id},[a("tr",{class:F(["resumo-legacy__row",{"is-expanded":i.value.has(`${m.id}-${e.id}`)||g.value.has(m.id)}]),"data-row-id":`${m.id}-${e.id}`},[a("td",pt,[a("div",vt,[e.children&&e.children.length>0?(y(),f("button",{key:0,type:"button",class:"resumo-legacy__prod-toggle","aria-expanded":i.value.has(`${m.id}-${e.id}`)||g.value.has(m.id),onClick:s=>v(`${m.id}-${e.id}`)},[N(L,{name:"chevron-right",class:F(["resumo-legacy__prod-toggle-icon",{"is-expanded":i.value.has(`${m.id}-${e.id}`)||g.value.has(m.id)}]),size:16},null,8,["class"]),a("span",{class:"resumo-legacy__prod-name",title:e.nome},n(e.nome),9,ht)],8,gt)):(y(),f("div",ft,[r[3]||(r[3]=a("span",{class:"resumo-legacy__prod-toggle-icon resumo-legacy__prod-toggle-icon--placeholder","aria-hidden":"true"},null,-1)),a("span",{class:"resumo-legacy__prod-name",title:e.nome},n(e.nome),9,yt)]))])]),a("td",bt,n(l(J)(e.pontosMeta||e.peso||0)),1),a("td",null,[a("span",{class:F(["resumo-legacy__metric",`resumo-legacy__metric--${e.metrica==="valor"?"valor":e.metrica==="qtd"?"qtd":e.metrica==="perc"?"perc":""}`]),title:`Métrica: ${e.metrica}`},n(e.metrica==="valor"?"Valor":e.metrica==="qtd"?"Quantidade":e.metrica==="perc"?"Percentual":e.metrica),11,$t)]),a("td",{class:"resumo-legacy__col--meta",title:l(B)(e.metrica,e.meta)},n(l(V)(e.metrica,e.meta)),9,kt),a("td",{class:"resumo-legacy__col--real",title:l(B)(e.metrica,e.realizado)},n(l(V)(e.metrica,e.realizado)),9,xt),a("td",{class:"resumo-legacy__col--ref",title:l(B)(e.metrica,e.referenciaHoje)},n(e.referenciaHoje!=null?l(V)(e.metrica,e.referenciaHoje):"—"),9,Mt),a("td",{class:"resumo-legacy__col--forecast",title:l(B)(e.metrica,e.projecao)},n(e.projecao!=null?l(V)(e.metrica,e.projecao):"—"),9,wt),a("td",{class:"resumo-legacy__col--meta-dia",title:l(B)(e.metrica,e.metaDiariaNecessaria)},n(e.metaDiariaNecessaria!=null?l(V)(e.metrica,e.metaDiariaNecessaria):"—"),9,zt),a("td",{class:"resumo-legacy__col--pontos",title:l(P)(e.pontos,{withUnit:!0})},n(l(P)(e.pontos,{withUnit:!0})),9,At),a("td",Pt,[a("div",Ft,[a("div",{class:F(["resumo-legacy__ating-meter",(e.ating||0)>=1?"is-ok":(e.ating||0)>=.5?"is-warn":"is-low"]),style:U({"--fill":Math.max(0,Math.min(1,e.ating||0))}),role:"progressbar","aria-valuemin":0,"aria-valuemax":200,"aria-valuenow":Math.max(0,Math.min(200,(e.ating||0)*100))},[a("span",Tt,n(e.meta>0?`${Math.max(0,Math.min(200,(e.ating||0)*100)).toFixed(1)}%`:"—"),1)],14,Rt)])]),a("td",Nt,n(e.ultimaAtualizacao?e.ultimaAtualizacao.match(/^\d{4}-\d{2}-\d{2}$/)?l(ra)(e.ultimaAtualizacao):e.ultimaAtualizacao:"—"),1)],10,mt),e.children&&e.children.length>0?(y(!0),f(E,{key:0},X(e.children,s=>(y(),f("tr",{key:s.id,class:F(["resumo-legacy__row resumo-legacy__row--child",{"is-visible":i.value.has(`${m.id}-${e.id}`)||g.value.has(m.id)}]),"data-row-id":`${m.id}-${e.id}-${s.id}`},[a("td",St,[a("div",Vt,[a("span",{class:"resumo-legacy__prod-name resumo-legacy__prod-name--child",title:s.nome},n(s.nome),9,Dt)])]),r[4]||(r[4]=a("td",{class:"resumo-legacy__col--peso"}," — ",-1)),a("td",null,[a("span",{class:F(["resumo-legacy__metric",`resumo-legacy__metric--${s.metrica==="valor"?"valor":s.metrica==="qtd"?"qtd":s.metrica==="perc"?"perc":""}`]),title:`Métrica: ${s.metrica}`},n(s.metrica==="valor"?"Valor":s.metrica==="qtd"?"Quantidade":s.metrica==="perc"?"Percentual":s.metrica),11,It)]),r[5]||(r[5]=a("td",{class:"resumo-legacy__col--meta"}," — ",-1)),a("td",{class:"resumo-legacy__col--real",title:l(B)(s.metrica,s.realizado)},n(l(V)(s.metrica,s.realizado)),9,Bt),r[6]||(r[6]=a("td",{class:"resumo-legacy__col--ref"}," — ",-1)),r[7]||(r[7]=a("td",{class:"resumo-legacy__col--forecast"}," — ",-1)),r[8]||(r[8]=a("td",{class:"resumo-legacy__col--meta-dia"}," — ",-1)),a("td",{class:"resumo-legacy__col--pontos",title:l(P)(s.pontos,{withUnit:!0})},n("-"),8,Et),r[9]||(r[9]=a("td",{class:"resumo-legacy__col--ating"}," — ",-1)),a("td",jt,n(s.ultimaAtualizacao?s.ultimaAtualizacao.match(/^\d{4}-\d{2}-\d{2}$/)?l(ra)(s.ultimaAtualizacao):s.ultimaAtualizacao:"—"),1)],10,Ct))),128)):H("",!0)],64))),128))])])])]))),128))]))}}),Lt=O(Ht,[["__scopeId","data-v-1d9b61e4"]]),qt={id:"view-cards",class:"view-section"},Ut={id:"resumo-summary",class:"resumo-summary"},Kt=Q({__name:"ResumoView",setup(R){const w=K("cards");return(b,p)=>(y(),f("section",qt,[N(ka,{modelValue:w.value,"onUpdate:modelValue":p[0]||(p[0]=$=>w.value=$)},null,8,["modelValue"]),a("div",Ut,[N(ts)]),a("div",{id:"resumo-cards",class:F(["resumo-mode__view",{hidden:w.value!=="cards"}])},[N(Ls)],2),a("div",{id:"resumo-legacy",class:F(["resumo-mode__view",{hidden:w.value!=="legacy"}]),"aria-live":"polite"},[N(Lt)],2)]))}}),Qt=O(Kt,[["__scopeId","data-v-2c87ba87"]]),Ot={class:"home-wrapper"},Wt=Q({__name:"Home",setup(R){return(w,b)=>(y(),f("div",Ot,[N(Qt)]))}}),ie=O(Wt,[["__scopeId","data-v-904e3431"]]);export{ie as default};
